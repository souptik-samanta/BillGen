<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Theme Bill & Card Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Creepster&family=Nosifer&family=Butcherman&display=swap');
    </style>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Theme Selection Modal -->
    <div id="themeModal" class="modal">
        <div class="modal-content">
            <h2>🎨 Choose Your Theme</h2>
            <div class="theme-grid">
                <div class="theme-card" onclick="selectTheme('silitech')">
                    <div class="theme-preview silitech-preview">
                        <span class="theme-emoji">🤖</span>
                        <h3>SILITECH</h3>
                        <p>Robotics & Electronics</p>
                    </div>
                    <button class="theme-btn">Select SILITECH</button>
                </div>
                
                <div class="theme-card" onclick="selectTheme('witchcraft')">
                    <div class="theme-preview witchcraft-preview">
                        <span class="theme-emoji">🔮</span>
                        <h3>WITCHCRAFT</h3>
                        <p>Vision Meeting Perfection</p>
                    </div>
                    <button class="theme-btn">Select WITCHCRAFT</button>
                </div>
                
                <div class="theme-card" onclick="selectTheme('waterny')">
                    <div class="theme-preview waterny-preview">
                        <span class="theme-emoji">💧</span>
                        <h3>WATERNY CARDS</h3>
                        <p>Digital Business Cards</p>
                    </div>
                    <button class="theme-btn">Select WATERNY</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container" id="mainContainer" style="display: none;">
        <!-- Dynamic Header will be inserted here -->
        <div class="header" id="dynamicHeader"></div>

        <!-- Theme Switcher Button -->
        <div class="theme-switcher">
            <button class="btn btn-theme" onclick="showThemeModal()">🎨 Switch Theme</button>
        </div>

        <!-- Dynamic Form Section -->
        <div class="form-section" id="dynamicForm">
            <!-- Form content will be dynamically generated based on selected theme -->
        </div>

        <!-- Dynamic Actions Section -->
        <div class="actions" id="dynamicActions">
            <!-- Actions will be dynamically generated based on selected theme -->
        </div>

        <div class="love-footer">
            Made with <span class="heart">❤️</span> by Souptik Samanta | Multi-Theme Generator
            <br>
            <small style="opacity: 0.8;">Website: soup-codes.site - Professional Bill & Card Generator</small>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p id="loadingText">Generating your document...</p>
        </div>
    </div>

    <script>
        let currentTheme = 'silitech';
        let itemCount = 1;

        // Theme configurations
        const themes = {
            silitech: {
                name: 'SILITECH',
                tagline: 'ROBOTICS & ELECTRONICS DEPARTMENT',
                emoji: '🤖',
                contact: 'silitechservices@gmail.com | WP: +91 7439442752',
                colors: {
                    primary: '#667eea',
                    secondary: '#764ba2',
                    accent: '#4ECDC4'
                },
                projectTypes: ['Robotics', 'Electronics', 'IoT Solutions', 'Automation', 'Custom Project']
            },
            witchcraft: {
                name: 'WITCHCRAFT',
                tagline: 'Vision Meeting Perfection',
                emoji: '🔮',
                contact: 'mysticalservices@witchcraft.com | Crystal Ball: +91 9876543210',
                colors: {
                    primary: '#2d1b69',
                    secondary: '#8b5cf6',
                    accent: '#c084fc'
                },
                projectTypes: ['Mystical Readings', 'Crystal Healing', 'Tarot Sessions', 'Spell Casting', 'Enchantments']
            },
            waterny: {
                name: 'WATERNY CARDS',
                tagline: 'Professional Digital Business Cards',
                emoji: '💧',
                contact: 'hello@waterny.com | Phone: +91 8888888888',
                colors: {
                    primary: '#0ea5e9',
                    secondary: '#0284c7',
                    accent: '#38bdf8'
                }
            }
        };

        // Show theme selection modal on page load
        document.addEventListener('DOMContentLoaded', function() {
            showThemeModal();
        });

        function showThemeModal() {
            document.getElementById('themeModal').style.display = 'flex';
            document.getElementById('mainContainer').style.display = 'none';
        }

        function selectTheme(theme) {
            currentTheme = theme;
            document.getElementById('themeModal').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'block';
            
            if (theme === 'waterny') {
                generateWaternyCardForm();
            } else {
                generateBillForm();
            }
            generateHeader();
            generateActions();
        }

        function generateHeader() {
            const theme = themes[currentTheme];
            const headerElement = document.getElementById('dynamicHeader');
            
            if (currentTheme === 'witchcraft') {
                headerElement.className = 'header witchcraft-header';
                headerElement.innerHTML = `
                    <div class="mystical-bg"></div>
                    <span class="theme-emoji">${theme.emoji}</span>
                    <h1>${theme.name}</h1>
                    <p>${theme.tagline}</p>
                    <div class="mystical-symbols">✨ 🌙 ⭐ 🔮 ✨</div>
                `;
            } else if (currentTheme === 'waterny') {
                headerElement.className = 'header waterny-header';
                headerElement.innerHTML = `
                    <div class="water-bg"></div>
                    <span class="theme-emoji">${theme.emoji}</span>
                    <h1>${theme.name}</h1>
                    <p>${theme.tagline}</p>
                    <div class="water-drops">💧 💎 💧 🌊 💧</div>
                `;
            } else {
                headerElement.className = 'header silitech-header';
                headerElement.innerHTML = `
                    <span class="theme-emoji">${theme.emoji}</span>
                    <h1>${theme.name}</h1>
                    <p>${theme.tagline}</p>
                `;
            }
        }

        function generateBillForm() {
            const theme = themes[currentTheme];
            const formElement = document.getElementById('dynamicForm');
            
            const projectOptions = theme.projectTypes.map(type => 
                `<option value="${type}">${type}</option>`
            ).join('');
            
            formElement.innerHTML = `
                <div class="form-row">
                    <div class="form-group">
                        <label for="customerName">${currentTheme === 'witchcraft' ? '🔮 Client Name *' : '👤 Customer Name *'}</label>
                        <input type="text" id="customerName" placeholder="${currentTheme === 'witchcraft' ? 'Enter mystical client name' : 'Enter customer name'}" required>
                    </div>
                    <div class="form-group">
                        <label for="customerPhone">${currentTheme === 'witchcraft' ? '📞 Crystal Communication' : '📱 Phone Number'}</label>
                        <input type="tel" id="customerPhone" placeholder="${currentTheme === 'witchcraft' ? 'Enter sacred number' : 'Enter phone number'}">
                    </div>
                    <div class="form-group">
                        <label for="customerEmail">${currentTheme === 'witchcraft' ? '✉️ Mystical Messages' : '📧 Email Address'}</label>
                        <input type="email" id="customerEmail" placeholder="${currentTheme === 'witchcraft' ? 'Enter mystical email' : 'Enter email address'}">
                    </div>
                </div>

                <div class="form-group">
                    <label for="customerAddress">${currentTheme === 'witchcraft' ? '🏠 Mystical Dwelling' : '🏠 Customer Address'}</label>
                    <textarea id="customerAddress" rows="3" placeholder="${currentTheme === 'witchcraft' ? 'Enter mystical address' : 'Enter customer address'}"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="billDate">${currentTheme === 'witchcraft' ? '🌙 Ritual Date' : '📅 Bill Date'}</label>
                        <input type="date" id="billDate">
                    </div>
                    <div class="form-group">
                        <label for="guaranteeDate">${currentTheme === 'witchcraft' ? '⭐ Magic Warranty Till' : '🛡️ Guarantee Till'}</label>
                        <input type="date" id="guaranteeDate">
                    </div>
                    <div class="form-group">
                        <label for="projectType">${currentTheme === 'witchcraft' ? '🔮 Service Type' : '⚡ Project Type'}</label>
                        <select id="projectType">
                            <option value="">Select Service Type</option>
                            ${projectOptions}
                        </select>
                    </div>
                </div>

                <div class="items-section ${currentTheme}-items">
                    <div class="items-header">
                        <h3>${currentTheme === 'witchcraft' ? '🔮 Mystical Services' : '🔧 Items & Services'}</h3>
                        <button type="button" class="btn btn-primary" onclick="addItem()">+ Add Item</button>
                    </div>
                    
                    <div id="itemsContainer">
                        <div class="item-row">
                            <div>
                                <label>${currentTheme === 'witchcraft' ? 'Mystical Service/Item *' : 'Item/Service Name *'}</label>
                                <input type="text" class="item-name" placeholder="${currentTheme === 'witchcraft' ? 'Enter mystical service' : 'Enter item or service name'}" required>
                            </div>
                            <div>
                                <label>Cost (Rs) *</label>
                                <input type="number" class="item-cost" placeholder="0.00" min="0" step="0.01" required>
                            </div>
                            <div>
                                <label>Quantity *</label>
                                <input type="number" class="item-qty" placeholder="1" min="1" value="1" required>
                            </div>
                            <div>
                                <label>&nbsp;</label>
                                <button type="button" class="btn btn-danger" onclick="removeItem(this)" style="display: none;">×</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="payment-status ${currentTheme}-payment">
                    <label><strong>${currentTheme === 'witchcraft' ? '💰 Mystical Exchange:' : '💳 Payment Status:'}</strong></label>
                    <div class="radio-group">
                        <input type="radio" id="paid" name="paymentStatus" value="PAID" checked>
                        <label for="paid">${currentTheme === 'witchcraft' ? '✨ Blessed (PAID)' : '✅ PAID'}</label>
                    </div>
                    <div class="radio-group">
                        <input type="radio" id="unpaid" name="paymentStatus" value="UNPAID">
                        <label for="unpaid">${currentTheme === 'witchcraft' ? '🌙 Awaiting Energy (UNPAID)' : '⏳ UNPAID'}</label>
                    </div>
                </div>

                <div class="summary ${currentTheme}-summary" id="billSummary">
                    <h3>${currentTheme === 'witchcraft' ? '🔮 Mystical Total' : '💰 Bill Summary'}</h3>
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">Rs 0.00</span>
                    </div>
                    <div class="summary-row total">
                        <span>${currentTheme === 'witchcraft' ? '✨ Grand Mystical Total:' : '🎯 Grand Total:'}</span>
                        <span id="grandTotal">Rs 0.00</span>
                    </div>
                </div>

                <div class="disclaimer">
                    <p>⚠️ This is a demo bill generator for educational purposes. Not for commercial use.</p>
                </div>
            `;
            
            initializeDates();
            attachCalculationListeners();
        }

        function generateWaternyCardForm() {
            const formElement = document.getElementById('dynamicForm');
            
            formElement.innerHTML = `
                <div class="card-preview" id="cardPreview">
                    <div class="business-card waterny-card">
                        <div class="card-front">
                            <div class="card-header">
                                <h2 id="previewName">Your Name</h2>
                                <p id="previewTitle">Your Title</p>
                            </div>
                            <div class="card-body">
                                <div class="contact-info">
                                    <p><span class="icon">📧</span> <span id="previewEmail">your@email.com</span></p>
                                    <p><span class="icon">📱</span> <span id="previewPhone">+91 9999999999</span></p>
                                    <p><span class="icon">🌐</span> <span id="previewWebsite">www.yourwebsite.com</span></p>
                                    <p><span class="icon">📍</span> <span id="previewLocation">Your Location</span></p>
                                </div>
                            </div>
                            <div class="waterny-logo">💧 WATERNY</div>
                        </div>
                    </div>
                </div>

                <div class="card-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cardName">👤 Full Name *</label>
                            <input type="text" id="cardName" placeholder="Enter your full name" required>
                        </div>
                        <div class="form-group">
                            <label for="cardTitle">💼 Job Title *</label>
                            <input type="text" id="cardTitle" placeholder="Enter your job title" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="cardEmail">📧 Email Address *</label>
                            <input type="email" id="cardEmail" placeholder="Enter your email" required>
                        </div>
                        <div class="form-group">
                            <label for="cardPhone">📱 Phone Number *</label>
                            <input type="tel" id="cardPhone" placeholder="Enter your phone number" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="cardWebsite">🌐 Website/LinkedIn</label>
                            <input type="url" id="cardWebsite" placeholder="Enter your website or LinkedIn">
                        </div>
                        <div class="form-group">
                            <label for="cardLocation">📍 Location</label>
                            <input type="text" id="cardLocation" placeholder="Enter your location">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="cardCompany">🏢 Company/Organization</label>
                        <input type="text" id="cardCompany" placeholder="Enter company name">
                    </div>

                    <div class="card-themes">
                        <label><strong>🎨 Card Theme:</strong></label>
                        <div class="theme-selector">
                            <input type="radio" id="blueTheme" name="cardTheme" value="blue" checked>
                            <label for="blueTheme" class="theme-option blue-theme">Ocean Blue</label>
                            
                            <input type="radio" id="greenTheme" name="cardTheme" value="green">
                            <label for="greenTheme" class="theme-option green-theme">Nature Green</label>
                            
                            <input type="radio" id="purpleTheme" name="cardTheme" value="purple">
                            <label for="purpleTheme" class="theme-option purple-theme">Royal Purple</label>
                            
                            <input type="radio" id="gradientTheme" name="cardTheme" value="gradient">
                            <label for="gradientTheme" class="theme-option gradient-theme">Sunset Gradient</label>
                        </div>
                    </div>
                </div>
            `;
            
            attachCardListeners();
        }

        function addItem() {
            itemCount++;
            const container = document.getElementById('itemsContainer');
            const newItem = document.createElement('div');
            newItem.className = 'item-row';
            
            const theme = themes[currentTheme];
            newItem.innerHTML = `
                <div>
                    <label>${currentTheme === 'witchcraft' ? 'Mystical Service/Item *' : 'Item/Service Name *'}</label>
                    <input type="text" class="item-name" placeholder="${currentTheme === 'witchcraft' ? 'Enter mystical service' : 'Enter item or service name'}" required>
                </div>
                <div>
                    <label>Cost (Rs) *</label>
                    <input type="number" class="item-cost" placeholder="0.00" min="0" step="0.01" required>
                </div>
                <div>
                    <label>Quantity *</label>
                    <input type="number" class="item-qty" placeholder="1" min="1" value="1" required>
                </div>
                <div>
                    <label>&nbsp;</label>
                    <button type="button" class="btn btn-danger" onclick="removeItem(this)">×</button>
                </div>
            `;
            container.appendChild(newItem);
            updateRemoveButtons();
            attachCalculationListeners(newItem);
        }

        function generateActions() {
            const actionsElement = document.getElementById('dynamicActions');
            
            if (currentTheme === 'waterny') {
                actionsElement.innerHTML = `
                    <button type="button" class="btn btn-success" onclick="generateBusinessCard()" style="margin-right: 20px;">
                        💳 Generate Business Card
                    </button>
                    <button type="button" class="btn btn-primary" onclick="downloadCardAsPNG()">
                        📱 Download as PNG
                    </button>
                `;
            } else {
                actionsElement.innerHTML = `
                    <button type="button" class="btn btn-success" onclick="generatePDF()" style="margin-right: 20px;">
                        📄 Generate PDF ${currentTheme === 'witchcraft' ? 'Grimoire' : 'Bill'}
                    </button>
                    <button type="button" class="btn btn-primary" onclick="previewBill()">
                        👁️ Preview ${currentTheme === 'witchcraft' ? 'Mystical Bill' : 'Bill'}
                    </button>
                `;
            }
        }

        function initializeDates() {
            const billDate = document.getElementById('billDate');
            const guaranteeDate = document.getElementById('guaranteeDate');
            
            if (billDate) {
                billDate.value = new Date().toISOString().split('T')[0];
            }
            
            if (guaranteeDate) {
                const future = new Date();
                future.setMonth(future.getMonth() + 1);
                guaranteeDate.value = future.toISOString().split('T')[0];
            }
        }

        function attachCardListeners() {
            const inputs = ['cardName', 'cardTitle', 'cardEmail', 'cardPhone', 'cardWebsite', 'cardLocation'];
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', updateCardPreview);
                }
            });
            
            const themeInputs = document.querySelectorAll('input[name="cardTheme"]');
            themeInputs.forEach(input => {
                input.addEventListener('change', updateCardTheme);
            });
        }

        function updateCardPreview() {
            const name = document.getElementById('cardName')?.value || 'Your Name';
            const title = document.getElementById('cardTitle')?.value || 'Your Title';
            const email = document.getElementById('cardEmail')?.value || 'your@email.com';
            const phone = document.getElementById('cardPhone')?.value || '+91 9999999999';
            const website = document.getElementById('cardWebsite')?.value || 'www.yourwebsite.com';
            const location = document.getElementById('cardLocation')?.value || 'Your Location';

            document.getElementById('previewName').textContent = name;
            document.getElementById('previewTitle').textContent = title;
            document.getElementById('previewEmail').textContent = email;
            document.getElementById('previewPhone').textContent = phone;
            document.getElementById('previewWebsite').textContent = website;
            document.getElementById('previewLocation').textContent = location;
        }

        function updateCardTheme() {
            const selectedTheme = document.querySelector('input[name="cardTheme"]:checked').value;
            const card = document.querySelector('.waterny-card');
            card.className = `business-card waterny-card ${selectedTheme}-card`;
        }

        function removeItem(button) {
            if (itemCount > 1) {
                button.closest('.item-row').remove();
                itemCount--;
                updateRemoveButtons();
                calculateTotals();
            }
        }

        function updateRemoveButtons() {
            const removeButtons = document.querySelectorAll('.btn-danger');
            removeButtons.forEach((btn, index) => {
                btn.style.display = itemCount > 1 ? 'block' : 'none';
            });
        }

        function attachCalculationListeners(container = document) {
            const inputs = container.querySelectorAll('.item-cost, .item-qty');
            inputs.forEach(input => {
                input.addEventListener('input', calculateTotals);
            });
        }

        function calculateTotals() {
            if (currentTheme === 'waterny') return;
            
            let total = 0;
            const itemRows = document.querySelectorAll('.item-row');
            
            itemRows.forEach(row => {
                const cost = parseFloat(row.querySelector('.item-cost')?.value) || 0;
                const qty = parseInt(row.querySelector('.item-qty')?.value) || 0;
                const itemTotal = cost * qty;
                total += itemTotal;
            });

            const subtotalElement = document.getElementById('subtotal');
            const grandTotalElement = document.getElementById('grandTotal');
            
            if (subtotalElement) subtotalElement.textContent = `Rs ${total.toFixed(2)}`;
            if (grandTotalElement) grandTotalElement.textContent = `Rs ${total.toFixed(2)}`;
        }

        function validateForm() {
            if (currentTheme === 'waterny') {
                const name = document.getElementById('cardName')?.value.trim();
                const title = document.getElementById('cardTitle')?.value.trim();
                const email = document.getElementById('cardEmail')?.value.trim();
                const phone = document.getElementById('cardPhone')?.value.trim();
                
                if (!name || !title || !email || !phone) {
                    alert('Please fill in all required fields (Name, Title, Email, Phone)');
                    return false;
                }
                return true;
            }
            
            const customerName = document.getElementById('customerName')?.value.trim();
            if (!customerName) {
                alert(currentTheme === 'witchcraft' ? 'Please enter the mystical client name' : 'Please enter customer name');
                return false;
            }

            const itemRows = document.querySelectorAll('.item-row');
            for (let row of itemRows) {
                const name = row.querySelector('.item-name')?.value.trim();
                const cost = row.querySelector('.item-cost')?.value;
                const qty = row.querySelector('.item-qty')?.value;
                
                if (!name || !cost || !qty) {
                    alert('Please fill in all required item fields');
                    return false;
                }
            }
            return true;
        }

        function getFormData() {
            if (currentTheme === 'waterny') {
                return {
                    name: document.getElementById('cardName')?.value.trim(),
                    title: document.getElementById('cardTitle')?.value.trim(),
                    email: document.getElementById('cardEmail')?.value.trim(),
                    phone: document.getElementById('cardPhone')?.value.trim(),
                    website: document.getElementById('cardWebsite')?.value.trim(),
                    location: document.getElementById('cardLocation')?.value.trim(),
                    company: document.getElementById('cardCompany')?.value.trim(),
                    theme: document.querySelector('input[name="cardTheme"]:checked')?.value || 'blue'
                };
            }
            
            const items = [];
            const itemRows = document.querySelectorAll('.item-row');
            
            itemRows.forEach(row => {
                const name = row.querySelector('.item-name')?.value.trim();
                const cost = parseFloat(row.querySelector('.item-cost')?.value) || 0;
                const qty = parseInt(row.querySelector('.item-qty')?.value) || 1;
                
                if (name && cost > 0) {
                    const itemTotal = cost * qty;
                    items.push({ name, cost, qty, itemTotal });
                }
            });

            const grandTotal = items.reduce((sum, item) => sum + item.itemTotal, 0);

            return {
                customerName: document.getElementById('customerName')?.value.trim(),
                customerPhone: document.getElementById('customerPhone')?.value.trim(),
                customerEmail: document.getElementById('customerEmail')?.value.trim(),
                customerAddress: document.getElementById('customerAddress')?.value.trim(),
                billDate: document.getElementById('billDate')?.value,
                guaranteeDate: document.getElementById('guaranteeDate')?.value,
                projectType: document.getElementById('projectType')?.value,
                paymentStatus: document.querySelector('input[name="paymentStatus"]:checked')?.value,
                items,
                grandTotal
            };
        }

        function generatePDF() {
            if (!validateForm()) return;

            document.getElementById('loading').style.display = 'block';
            document.getElementById('loadingText').textContent = 
                currentTheme === 'witchcraft' ? 'Brewing your mystical grimoire...' : 'Generating your professional bill...';
            
            setTimeout(() => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const data = getFormData();
                const theme = themes[currentTheme];

                // Theme-specific colors
                let primaryColor, accentColor, darkColor;
                if (currentTheme === 'witchcraft') {
                    primaryColor = [45, 27, 105];
                    accentColor = [139, 92, 246];
                    darkColor = [30, 20, 60];
                } else {
                    primaryColor = [102, 126, 234];
                    accentColor = [78, 205, 196];
                    darkColor = [44, 62, 80];
                }

                const lightGray = [248, 249, 250];

                // Header Background
                doc.setFillColor(...primaryColor);
                doc.rect(0, 0, 210, 50, 'F');
                
                // Title and emoji
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(28);
                doc.setFont('helvetica', 'bold');
                doc.text(theme.name, 105, 25, { align: 'center' });
                
                doc.setFontSize(14);
                doc.setFont('helvetica', 'normal');
                doc.text(theme.tagline, 105, 35, { align: 'center' });
                doc.text(theme.contact, 105, 43, { align: 'center' });

                // Invoice header
                doc.setTextColor(...darkColor);
                doc.setFontSize(20);
                doc.setFont('helvetica', 'bold');
                doc.text(currentTheme === 'witchcraft' ? 'MYSTICAL GRIMOIRE' : 'INVOICE', 20, 70);
                
                doc.setFontSize(11);
                doc.setFont('helvetica', 'normal');
                doc.text(`${currentTheme === 'witchcraft' ? 'Ritual' : 'Bill'} Date: ${new Date(data.billDate).toLocaleDateString('en-IN')}`, 20, 82);
                doc.text(`${currentTheme === 'witchcraft' ? 'Grimoire' : 'Bill'} No: ${theme.name.substring(0,2)}-${Date.now().toString().slice(-6)}`, 20, 92);
                
                if (data.guaranteeDate) {
                    doc.text(`${currentTheme === 'witchcraft' ? 'Magic Warranty' : 'Guarantee'} Till: ${new Date(data.guaranteeDate).toLocaleDateString('en-IN')}`, 20, 102);
                }

                if (data.projectType) {
                    doc.text(`${currentTheme === 'witchcraft' ? 'Service' : 'Project'} Type: ${data.projectType}`, 20, 112);
                }

                // Payment Status Stamp
                const stampX = 145;
                const stampY = 65;
                if (data.paymentStatus === 'PAID') {
                    doc.setDrawColor(76, 175, 80);
                    doc.setTextColor(76, 175, 80);
                } else {
                    doc.setDrawColor(244, 67, 54);
                    doc.setTextColor(244, 67, 54);
                }
                doc.setLineWidth(3);
                doc.rect(stampX, stampY, 45, 18);
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                const statusText = currentTheme === 'witchcraft' ? 
                    (data.paymentStatus === 'PAID' ? 'BLESSED' : 'PENDING') : 
                    data.paymentStatus;
                doc.text(statusText, stampX + 22.5, stampY + 12, { align: 'center' });

                // Customer Information Box
                doc.setFillColor(...lightGray);
                doc.rect(20, 125, 170, 45, 'F');
                doc.setDrawColor(...primaryColor);
                doc.setLineWidth(1);
                doc.rect(20, 125, 170, 45);

                doc.setTextColor(...darkColor);
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text(currentTheme === 'witchcraft' ? 'MYSTICAL CLIENT:' : 'BILL TO:', 25, 138);
                
                doc.setFontSize(12);
                doc.setFont('helvetica', 'normal');
                doc.text(data.customerName, 25, 150);
                if (data.customerPhone) {
                    doc.text(`📱 ${data.customerPhone}`, 25, 160);
                }
                if (data.customerEmail) {
                    doc.text(`📧 ${data.customerEmail}`, 100, 160);
                }
                if (data.customerAddress) {
                    const addressLines = doc.splitTextToSize(data.customerAddress, 80);
                    doc.text(addressLines, 25, 168);
                }

                // Items Table
                let yPos = 190;
                
                // Table Header
                doc.setFillColor(...primaryColor);
                doc.rect(20, yPos - 10, 170, 15, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(11);
                doc.setFont('helvetica', 'bold');
                doc.text(currentTheme === 'witchcraft' ? 'MYSTICAL SERVICE' : 'ITEM/SERVICE', 25, yPos);
                doc.text('RATE (Rs)', 110, yPos);
                doc.text('QTY', 140, yPos);
                doc.text('TOTAL (Rs)', 165, yPos);

                yPos += 20;

                // Items
                doc.setTextColor(...darkColor);
                doc.setFont('helvetica', 'normal');
                
                data.items.forEach((item, index) => {
                    if (yPos > 250) {
                        doc.addPage();
                        yPos = 30;
                    }
                    
                    // Alternate row colors
                    if (index % 2 === 0) {
                        doc.setFillColor(248, 249, 250);
                        doc.rect(20, yPos - 8, 170, 12, 'F');
                    }
                    
                    doc.text(item.name.substring(0, 25), 25, yPos);
                    doc.text(`Rs${item.cost.toFixed(2)}`, 110, yPos);
                    doc.text(item.qty.toString(), 140, yPos);
                    doc.text(`Rs${item.itemTotal.toFixed(2)}`, 165, yPos);
                    
                    yPos += 12;
                });

                // Total Section
                yPos += 25;
                doc.setFillColor(...accentColor);
                doc.rect(120, yPos - 8, 70, 15, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text('GRAND TOTAL:', 125, yPos);
                doc.text(`Rs${data.grandTotal.toFixed(2)}`, 165, yPos);

                // Footer
                const footerY = 270;
                doc.setTextColor(...darkColor);
                doc.setFontSize(10);
                doc.setFont('helvetica', 'italic');
                const thankYouText = currentTheme === 'witchcraft' ? 
                    'May your path be blessed with magic!' : 
                    `Thank you for choosing ${theme.name}!`;
                doc.text(thankYouText, 105, footerY, { align: 'center' });
                doc.text(`For support: ${theme.contact.split('|')[0].trim()}`, 105, footerY + 10, { align: 'center' });
                
                // Credits section
                doc.setFontSize(8);
                doc.setTextColor(100, 100, 100);
                doc.text('Made with ❤️ by Souptik Samanta', 105, footerY + 20, { align: 'center' });
                doc.text('Website: soup-codes.site - Bill Generator Platform', 105, footerY + 27, { align: 'center' });

                // Save PDF
                const fileName = `${theme.name}_${currentTheme === 'witchcraft' ? 'Grimoire' : 'Bill'}_${data.customerName.replace(/\s+/g, '_')}_${Date.now()}.pdf`;
                doc.save(fileName);
                
                document.getElementById('loading').style.display = 'none';
            }, 1500);
        }

        function generateBusinessCard() {
            if (!validateForm()) return;
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('loadingText').textContent = 'Generating your Waterny business card...';
            
            setTimeout(() => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('landscape', 'mm', [85.6, 53.98]); // Standard business card size
                const data = getFormData();
                
                // Theme colors
                const themes = {
                    blue: { bg: [14, 165, 233], accent: [56, 189, 248] },
                    green: { bg: [34, 197, 94], accent: [74, 222, 128] },
                    purple: { bg: [147, 51, 234], accent: [168, 85, 247] },
                    gradient: { bg: [251, 146, 60], accent: [252, 211, 77] }
                };
                
                const selectedTheme = themes[data.theme] || themes.blue;
                
                // Background
                doc.setFillColor(...selectedTheme.bg);
                doc.rect(0, 0, 85.6, 53.98, 'F');
                
                // Accent elements
                doc.setFillColor(...selectedTheme.accent);
                doc.circle(75, 10, 8, 'F');
                doc.circle(10, 45, 5, 'F');
                
                // Content
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text(data.name, 10, 15);
                
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.text(data.title, 10, 22);
                
                if (data.company) {
                    doc.setFontSize(8);
                    doc.text(data.company, 10, 28);
                }
                
                // Contact info
                doc.setFontSize(8);
                let yPos = 35;
                doc.text(`📧 ${data.email}`, 10, yPos);
                yPos += 4;
                doc.text(`📱 ${data.phone}`, 10, yPos);
                
                if (data.website) {
                    yPos += 4;
                    doc.text(`🌐 ${data.website}`, 10, yPos);
                }
                
                if (data.location) {
                    yPos += 4;
                    doc.text(`📍 ${data.location}`, 10, yPos);
                }
                
                // Waterny branding
                doc.setFontSize(10);
                doc.setFont('helvetica', 'bold');
                doc.text('💧 WATERNY', 60, 48);
                
                // Credits (very small)
                doc.setFontSize(6);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(200, 200, 200);
                doc.text('Made by Souptik Samanta | soup-codes.site', 5, 52);
                
                // Save
                const fileName = `Waterny_Card_${data.name.replace(/\s+/g, '_')}_${Date.now()}.pdf`;
                doc.save(fileName);
                
                document.getElementById('loading').style.display = 'none';
            }, 1000);
        }

        function downloadCardAsPNG() {
            if (!validateForm()) return;
            
            const card = document.querySelector('.waterny-card');
            
            // Use html2canvas if available, otherwise show message
            if (typeof html2canvas !== 'undefined') {
                html2canvas(card).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `Waterny_Card_${Date.now()}.png`;
                    link.href = canvas.toDataURL();
                    link.click();
                });
            } else {
                alert('PNG download requires html2canvas library. Use PDF generation for now.');
            }
        }

        function previewBill() {
            if (!validateForm()) return;
            
            const data = getFormData();
            const theme = themes[currentTheme];
            
            let previewContent = `
                <div style="text-align: center; background: ${currentTheme === 'witchcraft' ? 'linear-gradient(135deg, #2d1b69, #8b5cf6)' : 'linear-gradient(135deg, #667eea, #764ba2)'}; color: white; padding: 30px;">
                    <h1 style="font-size: 2.5em;">${theme.emoji} ${theme.name}</h1>
                    <h2>${theme.tagline}</h2>
                </div>
                <div style="padding: 20px; font-family: Arial, sans-serif;">
                    <h3>${currentTheme === 'witchcraft' ? 'Mystical Client Information' : 'Customer Information'}</h3>
                    <p><strong>Name:</strong> ${data.customerName}</p>
                    <p><strong>Phone:</strong> ${data.customerPhone || 'N/A'}</p>
                    <p><strong>Email:</strong> ${data.customerEmail || 'N/A'}</p>
                    <p><strong>Address:</strong> ${data.customerAddress || 'N/A'}</p>
                    <p><strong>Date:</strong> ${new Date(data.billDate).toLocaleDateString('en-IN')}</p>
                    <p><strong>Status:</strong> ${data.paymentStatus}</p>
                    ${data.projectType ? `<p><strong>Type:</strong> ${data.projectType}</p>` : ''}
                    <hr>
                    <h3>${currentTheme === 'witchcraft' ? 'Mystical Services:' : 'Items & Services:'}</h3>
            `;
            
            data.items.forEach((item, index) => {
                previewContent += `
                    <p>${index + 1}. ${item.name} - Rs${item.cost} × ${item.qty} = Rs${item.itemTotal.toFixed(2)}</p>
                `;
            });
            
            previewContent += `
                <hr>
                <p style="font-size: 1.2em;"><strong>Grand Total: Rs${data.grandTotal.toFixed(2)}</strong></p>
                <hr>
                <p style="text-align: center; color: #666; font-style: italic;">
                    ${currentTheme === 'witchcraft' ? 'May your journey be blessed with magic!' : 'Thank you for choosing ' + theme.name + '!'}
                </p>
            `;
            
            const previewWindow = window.open('', 'Preview', 'width=600,height=800');
            previewWindow.document.write(`
                <html>
                    <head>
                        <title>${currentTheme === 'witchcraft' ? 'Mystical Grimoire' : 'Bill'} Preview</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; margin: 0; }
                            .no-print { margin: 20px 0; text-align: center; }
                            @media print { .no-print { display: none; } }
                        </style>
                    </head>
                    <body>
                        <div class="no-print">
                            <button onclick="window.print()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">Print Preview</button>
                        </div>
                        ${previewContent}
                    </body>
                </html>
            `);
        }
    </script>
    
</body>
</html>