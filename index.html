<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Theme Bill & Card Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Creepster&family=Nosifer&family=Butcherman&display=swap" rel="stylesheet">
    
    <!-- Critical CSS for faster loading and fallback -->
    <style>
        * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Roboto', 'Arial', sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 20px;
}

/* Theme Selection Modal */
.modal {
    display: flex;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.8);
    align-items: center;
    justify-content: center;
}

.modal-content {
    background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
    padding: 40px;
    border-radius: 20px;
    box-shadow: 0 25px 50px rgba(0,0,0,0.3);
    max-width: 90%;
    width: 800px;
    text-align: center;
}

.modal-content h2 {
    margin-bottom: 30px;
    color: #2c3e50;
    font-size: 2.5em;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
}

.theme-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
}

.theme-card {
    background: white;
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
    cursor: pointer;
    border: 3px solid transparent;
}

.theme-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    border-color: #667eea;
}

.theme-preview {
    padding: 30px 20px;
    border-radius: 10px;
    margin-bottom: 15px;
    color: white;
    text-align: center;
}

.silitech-preview {
    background: linear-gradient(135deg, #667eea, #764ba2);
}

.witchcraft-preview {
    background: linear-gradient(135deg, #2d1b69, #8b5cf6);
    font-family: 'Creepster', cursive;
}

.waterny-preview {
    background: linear-gradient(135deg, #0ea5e9, #38bdf8);
}

.theme-emoji {
    font-size: 3em;
    display: block;
    margin-bottom: 10px;
}

.theme-preview h3 {
    font-size: 1.8em;
    margin-bottom: 5px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.theme-preview p {
    font-size: 1.1em;
    opacity: 0.9;
}

.theme-btn {
    width: 100%;
    padding: 15px;
    border: none;
    border-radius: 10px;
    background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
    color: white;
    font-size: 1.1em;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
}

.theme-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
}

/* Theme Switcher */
.theme-switcher {
    text-align: right;
    padding: 20px;
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
}

.btn-theme {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    padding: 12px 25px;
    border-radius: 25px;
    font-size: 1em;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
}

.container {
    max-width: 1000px;
    margin: 0 auto;
    background: white;
    border-radius: 20px;
    box-shadow: 0 25px 50px rgba(0,0,0,0.15);
    overflow: hidden;
}

/* Header Themes */
.header {
    color: white;
    padding: 40px;
    text-align: center;
    position: relative;
    overflow: hidden;
}

.silitech-header {
    background: linear-gradient(135deg, #FF6B6B, #4ECDC4, #45B7D1, #96CEB4, #FECA57);
    background-size: 300% 300%;
    animation: gradientShift 5s ease infinite;
}

.witchcraft-header {
    background: linear-gradient(135deg, #2d1b69, #8b5cf6, #c084fc);
    background-size: 300% 300%;
    animation: mysticalShift 8s ease infinite;
    font-family: 'Creepster', cursive;
}

.waterny-header {
    background: linear-gradient(135deg, #0ea5e9, #38bdf8, #0284c7);
    background-size: 300% 300%;
    animation: waterFlow 6s ease infinite;
}

.mystical-bg {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at 20% 50%, rgba(139, 92, 246, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(192, 132, 252, 0.3) 0%, transparent 50%);
    animation: mysticalPulse 4s ease-in-out infinite alternate;
}

.water-bg {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, rgba(56, 189, 248, 0.2) 25%, transparent 25%, transparent 75%, rgba(14, 165, 233, 0.2) 75%);
    background-size: 30px 30px;
    animation: waterMove 15s linear infinite;
}

.mystical-symbols, .water-drops {
    margin-top: 15px;
    font-size: 1.5em;
    animation: float 3s ease-in-out infinite;
}

/* Animations */
@keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

@keyframes mysticalShift {
    0% { background-position: 0% 50%; }
    33% { background-position: 100% 50%; }
    66% { background-position: 50% 100%; }
    100% { background-position: 0% 50%; }
}

@keyframes waterFlow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

@keyframes mysticalPulse {
    0% { opacity: 0.3; transform: scale(1); }
    100% { opacity: 0.7; transform: scale(1.1); }
}

@keyframes waterMove {
    0% { transform: translateX(0); }
    100% { transform: translateX(30px); }
}

@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
}

/* Business Card Styles */
.card-preview {
    display: flex;
    justify-content: center;
    margin-bottom: 30px;
    padding: 20px;
    background: linear-gradient(135deg, #f1f3f4, #e8eaed);
    border-radius: 15px;
}

.business-card {
    width: 350px;
    height: 220px;
    border-radius: 15px;
    box-shadow: 0 15px 35px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.business-card:hover {
    transform: rotateY(5deg) rotateX(5deg);
    box-shadow: 0 25px 50px rgba(0,0,0,0.3);
}

.waterny-card {
    background: linear-gradient(135deg, #0ea5e9, #38bdf8);
    color: white;
    padding: 20px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.blue-card { background: linear-gradient(135deg, #0ea5e9, #38bdf8); }
.green-card { background: linear-gradient(135deg, #22c55e, #4ade80); }
.purple-card { background: linear-gradient(135deg, #9333ea, #a855f7); }
.gradient-card { background: linear-gradient(135deg, #fb923c, #fcd34d); }

.card-front {
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.card-header h2 {
    font-size: 1.5em;
    margin-bottom: 5px;
    font-weight: bold;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.card-header p {
    font-size: 1em;
    opacity: 0.9;
}

.contact-info p {
    margin-bottom: 8px;
    font-size: 0.9em;
    display: flex;
    align-items: center;
}

.contact-info .icon {
    margin-right: 8px;
    font-size: 1em;
}

.waterny-logo {
    text-align: right;
    font-size: 1.2em;
    font-weight: bold;
    opacity: 0.8;
}

.card-form {
    padding: 30px;
    background: white;
    border-radius: 15px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}

.card-themes {
    margin-top: 20px;
}

.theme-selector {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.theme-option {
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 3px solid transparent;
    font-weight: bold;
    color: white;
}

.blue-theme { background: linear-gradient(135deg, #0ea5e9, #38bdf8); }
.green-theme { background: linear-gradient(135deg, #22c55e, #4ade80); }
.purple-theme { background: linear-gradient(135deg, #9333ea, #a855f7); }
.gradient-theme { background: linear-gradient(135deg, #fb923c, #fcd34d); }

.theme-option:hover {
    transform: scale(1.05);
    border-color: #fff;
}

input[type="radio"]:checked + .theme-option {
    border-color: #2c3e50;
    box-shadow: 0 0 20px rgba(44, 62, 80, 0.5);
}

input[type="radio"] {
    display: none;
}

/* Header Text Styles */
.header h1 {
    font-size: 3.5em;
    margin-bottom: 15px;
    text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
    font-weight: bold;
    letter-spacing: 3px;
    position: relative;
    z-index: 2;
}

.witchcraft-header h1 {
    font-family: 'Creepster', cursive;
    text-shadow: 0 0 20px rgba(192, 132, 252, 0.8),
                 0 0 40px rgba(139, 92, 246, 0.6);
    animation: mysticalGlow 3s ease-in-out infinite alternate;
}

.header .theme-emoji {
    font-size: 4em;
    display: block;
    margin-bottom: 10px;
    animation: bounce 2s infinite;
}

.witchcraft-header .theme-emoji {
    animation: mysticalFloat 4s ease-in-out infinite;
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(-10px); }
    60% { transform: translateY(-5px); }
}

@keyframes mysticalGlow {
    0% { 
        text-shadow: 0 0 20px rgba(192, 132, 252, 0.8),
                     0 0 40px rgba(139, 92, 246, 0.6);
    }
    100% { 
        text-shadow: 0 0 30px rgba(192, 132, 252, 1),
                     0 0 60px rgba(139, 92, 246, 0.8),
                     0 0 90px rgba(45, 27, 105, 0.6);
    }
}

@keyframes mysticalFloat {
    0%, 100% { 
        transform: translateY(0px) rotate(0deg);
        filter: drop-shadow(0 0 10px rgba(192, 132, 252, 0.5));
    }
    50% { 
        transform: translateY(-15px) rotate(5deg);
        filter: drop-shadow(0 0 20px rgba(139, 92, 246, 0.8));
    }
}

.header p {
    font-size: 1.4em;
    opacity: 0.95;
    position: relative;
    z-index: 2;
    font-weight: 600;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
}

.form-section {
    padding: 40px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}

.form-group {
    margin-bottom: 25px;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 25px;
    margin-bottom: 25px;
}

label {
    display: block;
    margin-bottom: 10px;
    font-weight: bold;
    color: #2c3e50;
    font-size: 1.1em;
}

input, select, textarea {
    width: 100%;
    padding: 15px;
    border: 3px solid #ddd;
    border-radius: 12px;
    font-size: 16px;
    transition: all 0.3s ease;
    background: white;
}

input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: #FF6B6B;
    box-shadow: 0 0 20px rgba(255, 107, 107, 0.3);
    transform: scale(1.02);
}

/* Theme-specific Items Sections */
.items-section {
    color: white;
    padding: 30px;
    margin: 25px 0;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}

.silitech-items {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.witchcraft-items {
    background: linear-gradient(135deg, #2d1b69, #8b5cf6, #c084fc);
    background-size: 300% 300%;
    animation: mysticalShift 8s ease infinite;
    position: relative;
}

.witchcraft-items::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at random, rgba(192, 132, 252, 0.2) 0%, transparent 50%);
    pointer-events: none;
}

/* Theme-specific Payment Status */
.payment-status {
    display: flex;
    gap: 30px;
    align-items: center;
    margin: 25px 0;
    padding: 20px;
    border-radius: 15px;
    color: white;
}

.silitech-payment {
    background: linear-gradient(135deg, #667eea, #764ba2);
}

.witchcraft-payment {
    background: linear-gradient(135deg, #2d1b69, #8b5cf6);
    font-family: 'Creepster', cursive;
}

/* Theme-specific Summaries */
.summary {
    color: white;
    padding: 30px;
    margin-top: 25px;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}

.silitech-summary {
    background: linear-gradient(135deg, #2c3e50, #3498db);
}

.witchcraft-summary {
    background: linear-gradient(135deg, #2d1b69, #8b5cf6);
    font-family: 'Creepster', cursive;
}

.disclaimer {
    text-align: center;
    padding: 20px;
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    color: white;
    border-radius: 10px;
    margin-top: 20px;
    font-size: 0.9em;
}

.items-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
}

.items-header h3 {
    font-size: 2em;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.item-row {
    display: grid;
    grid-template-columns: 3fr 1.5fr 1fr 80px;
    gap: 20px;
    align-items: end;
    margin-bottom: 20px;
    padding: 20px;
    background: rgba(255,255,255,0.95);
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    color: #2c3e50;
}

.item-row input {
    border: 2px solid #e9ecef;
}

.item-row input:focus {
    border-color: #4ECDC4;
    box-shadow: 0 0 15px rgba(78, 205, 196, 0.3);
}

.btn {
    padding: 15px 30px;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 2px;
    position: relative;
    overflow: hidden;
}

.btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s;
}

.btn:hover::before {
    left: 100%;
}

.btn-primary {
    background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
    color: white;
    box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
}

.btn-primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(255, 107, 107, 0.6);
}

.btn-success {
    background: linear-gradient(135deg, #96CEB4, #FECA57);
    color: white;
    box-shadow: 0 5px 15px rgba(150, 206, 180, 0.4);
}

.btn-success:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(150, 206, 180, 0.6);
}

.btn-danger {
    background: linear-gradient(135deg, #FF6B6B, #FF8E53);
    color: white;
    padding: 10px 15px;
    font-size: 18px;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.btn-danger:hover {
    transform: scale(1.1) rotate(90deg);
    box-shadow: 0 5px 15px rgba(255, 107, 107, 0.6);
}

.summary {
    background: linear-gradient(135deg, #2c3e50, #3498db);
    color: white;
    padding: 30px;
    margin-top: 25px;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}

.summary h3 {
    font-size: 1.8em;
    margin-bottom: 20px;
    text-align: center;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.summary-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
    font-size: 1.2em;
    padding: 10px 0;
}

.summary-row.total {
    border-top: 3px solid #4ECDC4;
    padding-top: 20px;
    margin-top: 20px;
    font-size: 1.5em;
    font-weight: bold;
    background: rgba(78, 205, 196, 0.1);
    border-radius: 10px;
    padding: 20px;
}

.payment-status {
    display: flex;
    gap: 30px;
    align-items: center;
    margin: 25px 0;
    padding: 20px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-radius: 15px;
    color: white;
}

.radio-group {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.1em;
    font-weight: bold;
}

.radio-group input[type="radio"] {
    width: 20px;
    height: 20px;
    margin: 0;
    transform: scale(1.2);
}

.actions {
    text-align: center;
    padding: 40px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}

.love-footer {
    text-align: center;
    padding: 20px;
    background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
    color: white;
    font-size: 1.2em;
    font-weight: bold;
}

.love-footer .heart {
    color: #FF1744;
    animation: heartbeat 1.5s ease-in-out infinite;
    font-size: 1.3em;
}

@keyframes heartbeat {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

@media (max-width: 768px) {
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .item-row {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .header h1 {
        font-size: 2.5em;
    }
}

.loading {
    display: none;
    text-align: center;
    padding: 30px;
    background: rgba(255,255,255,0.95);
    border-radius: 15px;
    margin: 20px;
}

.spinner {
    border: 5px solid #f3f3f3;
    border-top: 5px solid #FF6B6B;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
    margin: 0 auto 25px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Warranty Form Styles */
.warranty-form {
    padding: 20px;
}

.warranty-preview {
    margin-top: 30px;
    padding: 20px;
    background: var(--light-gray);
    border-radius: 12px;
    border: 2px solid var(--primary-color);
}

.warranty-card-preview {
    background: white;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    margin-top: 15px;
}

.warranty-header {
    text-align: center;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
}

.warranty-header h2 {
    font-size: 2.2rem;
    font-weight: bold;
    margin: 0 0 8px 0;
    letter-spacing: 2px;
}

.warranty-header p {
    font-size: 1.1rem;
    margin: 0;
    opacity: 0.9;
}

.warranty-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    font-size: 0.95rem;
}

.warranty-details p {
    margin: 8px 0;
    padding: 8px;
    background: var(--light-gray);
    border-radius: 6px;
}

.warranty-details strong {
    color: var(--primary-color);
    font-weight: 600;
}

.verification-code {
    grid-column: 1 / -1;
    background: var(--accent-color) !important;
    color: white;
    text-align: center;
    padding: 15px;
    border-radius: 8px;
    margin-top: 15px;
}

.verification-code p {
    margin: 0;
    font-size: 1.1rem;
}

.verification-code strong {
    color: white !important;
}

/* Enhanced Business Card Styles */
.business-card-form {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    padding: 30px;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
}

.business-card-form h2 {
    text-align: center;
    color: var(--primary-color);
    font-size: 1.8rem;
    margin-bottom: 10px;
}

.form-description {
    text-align: center;
    color: #64748b;
    margin-bottom: 30px;
    font-style: italic;
    font-size: 1.1rem;
}

.business-features {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 15px;
    flex-wrap: wrap;
}

.business-features span {
    background: rgba(255, 255, 255, 0.2);
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 0.9rem;
    backdrop-filter: blur(10px);
}

.professional-themes {
    background: white;
    padding: 25px;
    border-radius: 12px;
    margin-top: 20px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
}

.premium-selector {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.theme-option {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    border: 2px solid transparent;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    background: var(--light-gray);
}

.theme-option:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.theme-option input:checked + .theme-option {
    border-color: var(--accent-color);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.theme-color {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    margin-bottom: 10px;
}

.blue-theme .theme-color {
    background: linear-gradient(135deg, #0ea5e9, #0284c7);
}

.green-theme .theme-color {
    background: linear-gradient(135deg, #22c55e, #16a34a);
}

.purple-theme .theme-color {
    background: linear-gradient(135deg, #a855f7, #9333ea);
}

.gradient-theme .theme-color {
    background: linear-gradient(135deg, #fb923c, #fcd34d);
}

.theme-name {
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: 5px;
}

.theme-desc {
    font-size: 0.85rem;
    color: #64748b;
    text-align: center;
}

/* Enhanced Business Card Preview */
.card-preview {
    perspective: 1000px;
    margin-bottom: 30px;
}

.business-card {
    transform-style: preserve-3d;
    transition: transform 0.6s ease;
}

.business-card:hover {
    transform: rotateY(5deg) rotateX(5deg);
}

@media (max-width: 768px) {
    .business-features {
        gap: 10px;
    }
    
    .business-features span {
        font-size: 0.8rem;
        padding: 6px 12px;
    }
    
    .premium-selector {
        grid-template-columns: 1fr 1fr;
        gap: 10px;
    }
    
    .theme-option {
        padding: 15px 10px;
    }
}
    </style>
</head>
<body>
    <!-- Immediate style injection for web compatibility -->
    <script>
        // Ensure CSS variables are available immediately
        document.documentElement.style.setProperty('--primary-color', '#667eea');
        document.documentElement.style.setProperty('--secondary-color', '#764ba2');
        document.documentElement.style.setProperty('--accent-color', '#4ecdc4');
        document.documentElement.style.setProperty('--light-gray', '#f8f9fa');
        document.documentElement.style.setProperty('--primary-gradient', 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)');
        
        // Ensure body styling is applied immediately
        document.body.style.margin = '0';
        document.body.style.padding = '20px';
        document.body.style.fontFamily = "'Roboto', Arial, sans-serif";
        document.body.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
        document.body.style.minHeight = '100vh';
        document.body.style.boxSizing = 'border-box';
    </script>

    <!-- Theme Selection Modal -->
    <div id="themeModal" class="modal">
        <div class="modal-content">
            <h2>Choose Your Theme</h2>
            <div class="theme-grid">
                <div class="theme-card" onclick="selectTheme('silitech')">
                    <div class="theme-preview silitech-preview">
                        <h3>SILITECH</h3>
                        <p>Robotics & Electronics</p>
                    </div>
                    <button class="theme-btn">Select SILITECH</button>
                </div>
                
                <div class="theme-card" onclick="selectTheme('witchcraft')">
                    <div class="theme-preview witchcraft-preview">
                        <h3>WITCHCRAFT</h3>
                        <p>Vision Meeting Perfection</p>
                    </div>
                    <button class="theme-btn">Select WITCHCRAFT</button>
                </div>
                
                <div class="theme-card" onclick="selectTheme('waterny')">
                    <div class="theme-preview waterny-preview">
                        <h3>WATERNY BUSINESS CARDS</h3>
                        <p>Professional Digital Business Cards</p>
                    </div>
                    <button class="theme-btn">Create Business Card</button>
                </div>
                
                <div class="theme-card" onclick="selectTheme('warranty')">
                    <div class="theme-preview warranty-preview">
                        <h3>WARRANTY CARD</h3>
                        <p>SILITECH Official Warranty</p>
                    </div>
                    <button class="theme-btn">Select WARRANTY</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container" id="mainContainer" style="display: none;">
        <!-- Dynamic Header will be inserted here -->
        <div class="header" id="dynamicHeader"></div>

        <!-- Theme Switcher Button -->
        <div class="theme-switcher">
            <button class="btn btn-theme" onclick="showThemeModal()">Switch Theme</button>
        </div>

        <!-- Dynamic Form Section -->
        <div class="form-section" id="dynamicForm">
            <!-- Form content will be dynamically generated based on selected theme -->
        </div>

        <!-- Dynamic Actions Section -->
        <div class="actions" id="dynamicActions">
            <!-- Actions will be dynamically generated based on selected theme -->
        </div>

        <div class="love-footer">
            Made  <span class="heart"></span> by Souptik
            <br>
            <small style="opacity: 0.8;">Website: soup-codes.site - Professional Bill & Card Generator</small>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p id="loadingText">Generating your document...</p>
        </div>
    </div>

    <script>
        let currentTheme = 'silitech';
        let itemCount = 1;
        
        // Data storage for bills and sequential numbering
        const DATA_STORAGE_KEY = 'billgen_data';
        const COUNTERS_KEY = 'billgen_counters';
        
        // Initialize storage
        function initStorage() {
            if (!localStorage.getItem(DATA_STORAGE_KEY)) {
                localStorage.setItem(DATA_STORAGE_KEY, JSON.stringify([]));
            }
            if (!localStorage.getItem(COUNTERS_KEY)) {
                localStorage.setItem(COUNTERS_KEY, JSON.stringify({
                    silitech: 1,
                    witchcraft: 1,
                    warranty: 1
                }));
            }
        }
        
        // Get next bill number
        function getNextBillNumber(theme) {
            const counters = JSON.parse(localStorage.getItem(COUNTERS_KEY));
            const prefix = theme === 'silitech' ? 'ST' : theme === 'witchcraft' ? 'WC' : 'WR';
            const number = counters[theme].toString().padStart(4, '0');
            return `${prefix}-${number}`;
        }
        
        // Update counter
        function updateCounter(theme) {
            const counters = JSON.parse(localStorage.getItem(COUNTERS_KEY));
            counters[theme]++;
            localStorage.setItem(COUNTERS_KEY, JSON.stringify(counters));
        }
        
        // Save bill data
        function saveBillData(billData) {
            const data = JSON.parse(localStorage.getItem(DATA_STORAGE_KEY));
            data.push({
                ...billData,
                timestamp: new Date().toISOString(),
                id: Date.now()
            });
            localStorage.setItem(DATA_STORAGE_KEY, JSON.stringify(data));
        }
        
        // Generate verification barcode (simple encoding with secret key)
        function generateVerificationCode(billNumber) {
            const secretKey = 'SILITECH2024SECURE';
            let encoded = '';
            for (let i = 0; i < billNumber.length; i++) {
                const charCode = billNumber.charCodeAt(i);
                const keyChar = secretKey.charCodeAt(i % secretKey.length);
                encoded += (charCode + keyChar).toString(16).padStart(3, '0');
            }
            return encoded.toUpperCase();
        }

        // Theme configurations
        const themes = {
            silitech: {
                name: 'SILITECH',
                tagline: 'ROBOTICS & ELECTRONICS DEPARTMENT',
                emoji: '',
                contact: 'silitechservices@gmail.com | WP: +91 7439442752',
                colors: {
                    primary: '#667eea',
                    secondary: '#764ba2',
                    accent: '#4ECDC4'
                },
                projectTypes: ['Robotics', 'Electronics', 'IoT Solutions', 'Automation', 'Custom Project']
            },
            witchcraft: {
                name: 'WITCHCRAFT',
                tagline: 'Vision Meeting Perfection',
                emoji: '',
                contact: 'contactatwitchcraft.st@gmail.com | WP: +91 7439442752',
                colors: {
                    primary: '#2d1b69',
                    secondary: '#8b5cf6',
                    accent: '#c084fc'
                },
                projectTypes: ['PCB Design', 'Automation', 'Electronic Prototyping', 'Embedded Systems', 'Hardware Testing']
            },
            waterny: {
                name: 'WATERNY BUSINESS CARDS',
                tagline: 'Professional Digital Business Cards & Networking',
                emoji: '',
                contact: 'hello@waterny.com | Phone: +91 8888888888 | Create Your Professional Identity',
                colors: {
                    primary: '#0ea5e9',
                    secondary: '#0284c7',
                    accent: '#38bdf8'
                }
            },
            warranty: {
                name: 'SILITECH WARRANTY',
                tagline: 'Official Warranty Certificate',
                emoji: '',
                contact: 'silitechservices@gmail.com | WP: +91 7439442752',
                colors: {
                    primary: '#28a745',
                    secondary: '#20c997',
                    accent: '#17a2b8'
                }
            }
        };

        // Show theme selection modal on page load
        document.addEventListener('DOMContentLoaded', function() {
            showThemeModal();
        });

        function showThemeModal() {
            document.getElementById('themeModal').style.display = 'flex';
            document.getElementById('mainContainer').style.display = 'none';
        }

        function selectTheme(theme) {
            currentTheme = theme;
            document.getElementById('themeModal').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'block';
            
            if (theme === 'waterny') {
                generateWaternyCardForm();
            } else if (theme === 'warranty') {
                generateWarrantyForm();
            } else {
                generateBillForm();
            }
            generateHeader();
            generateActions();
        }

        function generateHeader() {
            const theme = themes[currentTheme];
            const headerElement = document.getElementById('dynamicHeader');
            
            if (currentTheme === 'witchcraft') {
                headerElement.className = 'header witchcraft-header';
                headerElement.innerHTML = `
                    <div class="mystical-bg"></div>
                    <h1>${theme.name}</h1>
                    <p>${theme.tagline}</p>
                `;
            } else if (currentTheme === 'waterny') {
                headerElement.className = 'header waterny-header';
                headerElement.innerHTML = `
                    <div class="water-bg"></div>
                    <h1>${theme.name}</h1>
                    <p>${theme.tagline}</p>
                    <div class="business-features">
                        <span>📇 Professional Cards</span>
                        <span>🌐 Digital Ready</span>
                        <span>🎨 Multiple Themes</span>
                    </div>
                `;
            } else if (currentTheme === 'warranty') {
                headerElement.className = 'header warranty-header';
                headerElement.innerHTML = `
                    <h1>${theme.name}</h1>
                    <p>${theme.tagline}</p>
                `;
            } else {
                headerElement.className = 'header silitech-header';
                headerElement.innerHTML = `
                    <h1>${theme.name}</h1>
                    <p>${theme.tagline}</p>
                `;
            }
        }

        function generateBillForm() {
            const theme = themes[currentTheme];
            const formElement = document.getElementById('dynamicForm');
            
            const projectOptions = theme.projectTypes.map(type => 
                `<option value="${type}">${type}</option>`
            ).join('');
            
            formElement.innerHTML = `
                <div class="form-row">
                    <div class="form-group">
                        <label for="customerName">${currentTheme === 'witchcraft' ? 'Client Name *' : 'Customer Name *'}</label>
                        <input type="text" id="customerName" placeholder="${currentTheme === 'witchcraft' ? 'Enter client name' : 'Enter customer name'}" required>
                    </div>
                    <div class="form-group">
                        <label for="customerPhone">${currentTheme === 'witchcraft' ? 'Phone Number' : 'Phone Number'}</label>
                        <input type="tel" id="customerPhone" placeholder="${currentTheme === 'witchcraft' ? 'Enter phone number' : 'Enter phone number'}">
                    </div>
                    <div class="form-group">
                        <label for="customerEmail">${currentTheme === 'witchcraft' ? 'Email Address' : 'Email Address'}</label>
                        <input type="email" id="customerEmail" placeholder="${currentTheme === 'witchcraft' ? 'Enter email address' : 'Enter email address'}">
                    </div>
                </div>

                <div class="form-group">
                    <label for="customerAddress">${currentTheme === 'witchcraft' ? 'Client Address' : 'Customer Address'}</label>
                    <textarea id="customerAddress" rows="3" placeholder="${currentTheme === 'witchcraft' ? 'Enter client address' : 'Enter customer address'}"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="billDate">${currentTheme === 'witchcraft' ? 'Service Date' : 'Bill Date'}</label>
                        <input type="date" id="billDate">
                    </div>
                    <div class="form-group">
                        <label for="guaranteeDate">${currentTheme === 'witchcraft' ? 'Warranty Till' : 'Guarantee Till'}</label>
                        <input type="date" id="guaranteeDate">
                    </div>
                    <div class="form-group">
                        <label for="projectType">${currentTheme === 'witchcraft' ? 'Service Type' : 'Project Type'}</label>
                        <select id="projectType">
                            <option value="">Select Service Type</option>
                            ${projectOptions}
                        </select>
                    </div>
                </div>

                <div class="items-section ${currentTheme}-items">
                    <div class="items-header">
                        <h3>${currentTheme === 'witchcraft' ? 'Services & Components' : 'Items & Services'}</h3>
                        <button type="button" class="btn btn-primary" onclick="addItem()">+ Add Item</button>
                    </div>
                    
                    <div id="itemsContainer">
                        <div class="item-row">
                            <div>
                                <label>${currentTheme === 'witchcraft' ? 'Service/Component Name *' : 'Item/Service Name *'}</label>
                                <input type="text" class="item-name" placeholder="${currentTheme === 'witchcraft' ? 'Enter service or component name' : 'Enter item or service name'}" required>
                            </div>
                            <div>
                                <label>Cost (Rs) *</label>
                                <input type="number" class="item-cost" placeholder="0.00" min="0" step="0.01" required>
                            </div>
                            <div>
                                <label>Quantity *</label>
                                <input type="number" class="item-qty" placeholder="1" min="1" value="1" required>
                            </div>
                            <div>
                                <label>&nbsp;</label>
                                <button type="button" class="btn btn-danger" onclick="removeItem(this)" style="display: none;">×</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="payment-status ${currentTheme}-payment">
                    <label><strong>${currentTheme === 'witchcraft' ? 'Payment Status:' : 'Payment Status:'}</strong></label>
                    <div class="radio-group">
                        <input type="radio" id="paid" name="paymentStatus" value="PAID" checked>
                        <label for="paid">${currentTheme === 'witchcraft' ? 'PAID' : 'PAID'}</label>
                    </div>
                    <div class="radio-group">
                        <input type="radio" id="unpaid" name="paymentStatus" value="UNPAID">
                        <label for="unpaid">${currentTheme === 'witchcraft' ? 'UNPAID' : 'UNPAID'}</label>
                    </div>
                </div>

                <div class="summary ${currentTheme}-summary" id="billSummary">
                    <h3>${currentTheme === 'witchcraft' ? 'Bill Summary' : 'Bill Summary'}</h3>
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">Rs 0.00</span>
                    </div>
                    <div class="summary-row total">
                        <span>${currentTheme === 'witchcraft' ? 'Grand Total:' : 'Grand Total:'}</span>
                        <span id="grandTotal">Rs 0.00</span>
                    </div>
                </div>

                <div class="disclaimer">
                    <p>WARNING: This is a demo bill generator for educational purposes. Not for commercial use.</p>
                </div>
            `;
            
            initializeDates();
            attachCalculationListeners();
        }

        function generateWaternyCardForm() {
            const formElement = document.getElementById('dynamicForm');
            
            formElement.innerHTML = `
                <div class="card-preview" id="cardPreview">
                    <div class="business-card waterny-card">
                        <div class="card-front">
                            <div class="card-header">
                                <h2 id="previewName">Your Name</h2>
                                <p id="previewTitle">Your Title</p>
                            </div>
                            <div class="card-body">
                                <div class="contact-info">
                                    <p><span class="icon">Email:</span> <span id="previewEmail">your@email.com</span></p>
                                    <p><span class="icon">Phone:</span> <span id="previewPhone">+91 9999999999</span></p>
                                    <p><span class="icon">Web:</span> <span id="previewWebsite">www.yourwebsite.com</span></p>
                                    <p><span class="icon">Location:</span> <span id="previewLocation">Your Location</span></p>
                                </div>
                            </div>
                            <div class="waterny-logo">WATERNY</div>
                        </div>
                    </div>
                </div>

                <div class="card-form business-card-form">
                    <h2>🎨 Create Your Professional Business Card</h2>
                    <p class="form-description">Design a stunning digital business card that makes a lasting impression!</p>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cardName">👤 Full Name *</label>
                            <input type="text" id="cardName" placeholder="Enter your full name" required>
                        </div>
                        <div class="form-group">
                            <label for="cardTitle">💼 Job Title *</label>
                            <input type="text" id="cardTitle" placeholder="e.g., Senior Developer, Marketing Manager" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="cardEmail">📧 Email Address *</label>
                            <input type="email" id="cardEmail" placeholder="your.name@company.com" required>
                        </div>
                        <div class="form-group">
                            <label for="cardPhone">📱 Phone Number *</label>
                            <input type="tel" id="cardPhone" placeholder="+91 9999999999" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="cardWebsite">🌐 Website/LinkedIn</label>
                            <input type="url" id="cardWebsite" placeholder="www.yourwebsite.com or linkedin.com/in/yourname">
                        </div>
                        <div class="form-group">
                            <label for="cardLocation">📍 Location</label>
                            <input type="text" id="cardLocation" placeholder="City, Country">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="cardCompany">🏢 Company/Organization</label>
                        <input type="text" id="cardCompany" placeholder="Your Amazing Company Ltd.">
                    </div>

                    <div class="card-themes professional-themes">
                        <label><strong>🎨 Choose Your Professional Theme:</strong></label>
                        <div class="theme-selector premium-selector">
                            <input type="radio" id="blueTheme" name="cardTheme" value="blue" checked>
                            <label for="blueTheme" class="theme-option blue-theme">
                                <span class="theme-color"></span>
                                <span class="theme-name">Ocean Blue</span>
                                <span class="theme-desc">Professional & Trustworthy</span>
                            </label>
                            
                            <input type="radio" id="greenTheme" name="cardTheme" value="green">
                            <label for="greenTheme" class="theme-option green-theme">
                                <span class="theme-color"></span>
                                <span class="theme-name">Nature Green</span>
                                <span class="theme-desc">Fresh & Eco-Friendly</span>
                            </label>
                            
                            <input type="radio" id="purpleTheme" name="cardTheme" value="purple">
                            <label for="purpleTheme" class="theme-option purple-theme">
                                <span class="theme-color"></span>
                                <span class="theme-name">Royal Purple</span>
                                <span class="theme-desc">Creative & Luxurious</span>
                            </label>
                            
                            <input type="radio" id="gradientTheme" name="cardTheme" value="gradient">
                            <label for="gradientTheme" class="theme-option gradient-theme">
                                <span class="theme-color"></span>
                                <span class="theme-name">Sunset Gradient</span>
                                <span class="theme-desc">Modern & Dynamic</span>
                            </label>
                        </div>
                    </div>
                </div>
            `;
            
            attachCardListeners();
        }

        function generateWarrantyForm() {
            const formElement = document.getElementById('dynamicForm');
            
            formElement.innerHTML = `
                <div class="warranty-form">
                    <h2>Warranty Card Details</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="customerName">Customer Name *</label>
                            <input type="text" id="customerName" placeholder="Enter customer name" required>
                        </div>
                        <div class="form-group">
                            <label for="customerPhone">Phone Number *</label>
                            <input type="tel" id="customerPhone" placeholder="Enter phone number" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="customerAddress">Customer Address *</label>
                        <textarea id="customerAddress" rows="3" placeholder="Enter complete address" required></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="billNumber">Bill Number *</label>
                            <input type="text" id="billNumber" placeholder="Enter linked bill number" required>
                        </div>
                        <div class="form-group">
                            <label for="purchaseDate">Purchase Date *</label>
                            <input type="date" id="purchaseDate" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="productName">Product Name *</label>
                            <input type="text" id="productName" placeholder="Enter product name" required>
                        </div>
                        <div class="form-group">
                            <label for="warrantyPeriod">Warranty Period (months) *</label>
                            <input type="number" id="warrantyPeriod" min="1" max="120" value="12" required>
                        </div>
                    </div>

                    <div class="warranty-preview" id="warrantyPreview">
                        <h3>Warranty Card Preview</h3>
                        <div class="warranty-card-preview">
                            <div class="warranty-header">
                                <h2>SILITECH</h2>
                                <p>WARRANTY CARD</p>
                            </div>
                            <div class="warranty-details">
                                <p><strong>Customer:</strong> <span id="previewCustomerName">Customer Name</span></p>
                                <p><strong>Product:</strong> <span id="previewProductName">Product Name</span></p>
                                <p><strong>Bill No:</strong> <span id="previewBillNumber">Bill Number</span></p>
                                <p><strong>Purchase Date:</strong> <span id="previewPurchaseDate">Purchase Date</span></p>
                                <p><strong>Warranty Period:</strong> <span id="previewWarrantyPeriod">12 months</span></p>
                                <div class="verification-code">
                                    <p><strong>Verification Code:</strong> <span id="previewVerificationCode">VERIFY123</span></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button type="button" class="generate-btn" onclick="generateWarrantyPDF()">Generate Warranty Card PDF</button>
                </div>
            `;
            
            initializeWarrantyDates();
            attachWarrantyListeners();
        }

        function addItem() {
            itemCount++;
            const container = document.getElementById('itemsContainer');
            const newItem = document.createElement('div');
            newItem.className = 'item-row';
            
            const theme = themes[currentTheme];
            newItem.innerHTML = `
                <div>
                    <label>${currentTheme === 'witchcraft' ? 'Service/Component Name *' : 'Item/Service Name *'}</label>
                    <input type="text" class="item-name" placeholder="${currentTheme === 'witchcraft' ? 'Enter service or component name' : 'Enter item or service name'}" required>
                </div>
                <div>
                    <label>Cost (Rs) *</label>
                    <input type="number" class="item-cost" placeholder="0.00" min="0" step="0.01" required>
                </div>
                <div>
                    <label>Quantity *</label>
                    <input type="number" class="item-qty" placeholder="1" min="1" value="1" required>
                </div>
                <div>
                    <label>&nbsp;</label>
                    <button type="button" class="btn btn-danger" onclick="removeItem(this)">×</button>
                </div>
            `;
            container.appendChild(newItem);
            updateRemoveButtons();
            attachCalculationListeners(newItem);
        }

        function generateActions() {
            const actionsElement = document.getElementById('dynamicActions');
            
            if (currentTheme === 'waterny') {
                actionsElement.innerHTML = `
                    <button type="button" class="btn btn-success" onclick="generateBusinessCard()" style="margin-right: 20px;">
                        Generate Business Card
                    </button>
                    <button type="button" class="btn btn-primary" onclick="downloadCardAsPNG()">
                        Download as PNG
                    </button>
                `;
            } else {
                actionsElement.innerHTML = `
                    <button type="button" class="btn btn-success" onclick="generatePDF()" style="margin-right: 20px;">
                        Generate PDF ${currentTheme === 'witchcraft' ? 'Invoice' : 'Bill'}
                    </button>
                    <button type="button" class="btn btn-primary" onclick="previewBill()">
                        Preview ${currentTheme === 'witchcraft' ? 'Invoice' : 'Bill'}
                    </button>
                `;
            }
        }

        function initializeDates() {
            const billDate = document.getElementById('billDate');
            const guaranteeDate = document.getElementById('guaranteeDate');
            
            if (billDate) {
                billDate.value = new Date().toISOString().split('T')[0];
            }
            
            if (guaranteeDate) {
                const future = new Date();
                future.setMonth(future.getMonth() + 1);
                guaranteeDate.value = future.toISOString().split('T')[0];
            }
        }

        function attachCardListeners() {
            const inputs = ['cardName', 'cardTitle', 'cardEmail', 'cardPhone', 'cardWebsite', 'cardLocation'];
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', updateCardPreview);
                }
            });
            
            const themeInputs = document.querySelectorAll('input[name="cardTheme"]');
            themeInputs.forEach(input => {
                input.addEventListener('change', updateCardTheme);
            });
        }

        function updateCardPreview() {
            const name = document.getElementById('cardName')?.value || 'Your Name';
            const title = document.getElementById('cardTitle')?.value || 'Your Title';
            const email = document.getElementById('cardEmail')?.value || 'your@email.com';
            const phone = document.getElementById('cardPhone')?.value || '+91 9999999999';
            const website = document.getElementById('cardWebsite')?.value || 'www.yourwebsite.com';
            const location = document.getElementById('cardLocation')?.value || 'Your Location';

            document.getElementById('previewName').textContent = name;
            document.getElementById('previewTitle').textContent = title;
            document.getElementById('previewEmail').textContent = email;
            document.getElementById('previewPhone').textContent = phone;
            document.getElementById('previewWebsite').textContent = website;
            document.getElementById('previewLocation').textContent = location;
        }

        function updateCardTheme() {
            const selectedTheme = document.querySelector('input[name="cardTheme"]:checked').value;
            const card = document.querySelector('.waterny-card');
            card.className = `business-card waterny-card ${selectedTheme}-card`;
        }

        function removeItem(button) {
            if (itemCount > 1) {
                button.closest('.item-row').remove();
                itemCount--;
                updateRemoveButtons();
                calculateTotals();
            }
        }

        function updateRemoveButtons() {
            const removeButtons = document.querySelectorAll('.btn-danger');
            removeButtons.forEach((btn, index) => {
                btn.style.display = itemCount > 1 ? 'block' : 'none';
            });
        }

        function initializeWarrantyDates() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('purchaseDate').value = today;
        }

        function attachWarrantyListeners() {
            const inputs = ['customerName', 'productName', 'billNumber', 'purchaseDate', 'warrantyPeriod'];
            
            inputs.forEach(inputId => {
                const element = document.getElementById(inputId);
                if (element) {
                    element.addEventListener('input', updateWarrantyPreview);
                }
            });
            
            updateWarrantyPreview();
        }

        function updateWarrantyPreview() {
            const customerName = document.getElementById('customerName')?.value || 'Customer Name';
            const productName = document.getElementById('productName')?.value || 'Product Name';
            const billNumber = document.getElementById('billNumber')?.value || 'Bill Number';
            const purchaseDate = document.getElementById('purchaseDate')?.value || 'Purchase Date';
            const warrantyPeriod = document.getElementById('warrantyPeriod')?.value || '12';
            
            // Update preview elements
            const previewCustomerName = document.getElementById('previewCustomerName');
            const previewProductName = document.getElementById('previewProductName');
            const previewBillNumber = document.getElementById('previewBillNumber');
            const previewPurchaseDate = document.getElementById('previewPurchaseDate');
            const previewWarrantyPeriod = document.getElementById('previewWarrantyPeriod');
            const previewVerificationCode = document.getElementById('previewVerificationCode');
            
            if (previewCustomerName) previewCustomerName.textContent = customerName;
            if (previewProductName) previewProductName.textContent = productName;
            if (previewBillNumber) previewBillNumber.textContent = billNumber;
            if (previewPurchaseDate) previewPurchaseDate.textContent = purchaseDate;
            if (previewWarrantyPeriod) previewWarrantyPeriod.textContent = warrantyPeriod + ' months';
            
            // Generate verification code
            if (billNumber && customerName) {
                const verificationCode = generateVerificationCode(billNumber, customerName);
                if (previewVerificationCode) previewVerificationCode.textContent = verificationCode;
            }
        }

        function attachCalculationListeners(container = document) {
            const inputs = container.querySelectorAll('.item-cost, .item-qty');
            inputs.forEach(input => {
                input.addEventListener('input', calculateTotals);
            });
        }

        function calculateTotals() {
            if (currentTheme === 'waterny') return;
            
            let total = 0;
            const itemRows = document.querySelectorAll('.item-row');
            
            itemRows.forEach(row => {
                const cost = parseFloat(row.querySelector('.item-cost')?.value) || 0;
                const qty = parseInt(row.querySelector('.item-qty')?.value) || 0;
                const itemTotal = cost * qty;
                total += itemTotal;
            });

            const subtotalElement = document.getElementById('subtotal');
            const grandTotalElement = document.getElementById('grandTotal');
            
            if (subtotalElement) subtotalElement.textContent = `Rs ${total.toFixed(2)}`;
            if (grandTotalElement) grandTotalElement.textContent = `Rs ${total.toFixed(2)}`;
        }

        function validateForm() {
            if (currentTheme === 'waterny') {
                const name = document.getElementById('cardName')?.value.trim();
                const title = document.getElementById('cardTitle')?.value.trim();
                const email = document.getElementById('cardEmail')?.value.trim();
                const phone = document.getElementById('cardPhone')?.value.trim();
                
                if (!name || !title || !email || !phone) {
                    alert('Please fill in all required fields (Name, Title, Email, Phone)');
                    return false;
                }
                return true;
            }
            
            const customerName = document.getElementById('customerName')?.value.trim();
            if (!customerName) {
                alert(currentTheme === 'witchcraft' ? 'Please enter the client name' : 'Please enter customer name');
                return false;
            }

            const itemRows = document.querySelectorAll('.item-row');
            for (let row of itemRows) {
                const name = row.querySelector('.item-name')?.value.trim();
                const cost = row.querySelector('.item-cost')?.value;
                const qty = row.querySelector('.item-qty')?.value;
                
                if (!name || !cost || !qty) {
                    alert('Please fill in all required item fields');
                    return false;
                }
            }
            return true;
        }

        function getFormData() {
            if (currentTheme === 'waterny') {
                return {
                    name: document.getElementById('cardName')?.value.trim(),
                    title: document.getElementById('cardTitle')?.value.trim(),
                    email: document.getElementById('cardEmail')?.value.trim(),
                    phone: document.getElementById('cardPhone')?.value.trim(),
                    website: document.getElementById('cardWebsite')?.value.trim(),
                    location: document.getElementById('cardLocation')?.value.trim(),
                    company: document.getElementById('cardCompany')?.value.trim(),
                    theme: document.querySelector('input[name="cardTheme"]:checked')?.value || 'blue'
                };
            }
            
            const items = [];
            const itemRows = document.querySelectorAll('.item-row');
            
            itemRows.forEach(row => {
                const name = row.querySelector('.item-name')?.value.trim();
                const cost = parseFloat(row.querySelector('.item-cost')?.value) || 0;
                const qty = parseInt(row.querySelector('.item-qty')?.value) || 1;
                
                if (name && cost > 0) {
                    const itemTotal = cost * qty;
                    items.push({ name, cost, qty, itemTotal });
                }
            });

            const grandTotal = items.reduce((sum, item) => sum + item.itemTotal, 0);

            return {
                customerName: document.getElementById('customerName')?.value.trim(),
                customerPhone: document.getElementById('customerPhone')?.value.trim(),
                customerEmail: document.getElementById('customerEmail')?.value.trim(),
                customerAddress: document.getElementById('customerAddress')?.value.trim(),
                billDate: document.getElementById('billDate')?.value,
                guaranteeDate: document.getElementById('guaranteeDate')?.value,
                projectType: document.getElementById('projectType')?.value,
                paymentStatus: document.querySelector('input[name="paymentStatus"]:checked')?.value,
                items,
                grandTotal
            };
        }

        function generatePDF() {
            if (!validateForm()) return;

            document.getElementById('loading').style.display = 'block';
            document.getElementById('loadingText').textContent = 
                currentTheme === 'witchcraft' ? 'Generating your professional invoice...' : 'Generating your professional bill...';
            
            setTimeout(() => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const data = getFormData();
                const theme = themes[currentTheme];

                // Theme-specific colors
                let primaryColor, accentColor, darkColor;
                if (currentTheme === 'witchcraft') {
                    primaryColor = [45, 27, 105];
                    accentColor = [139, 92, 246];
                    darkColor = [30, 20, 60];
                } else {
                    primaryColor = [102, 126, 234];
                    accentColor = [78, 205, 196];
                    darkColor = [44, 62, 80];
                }

                const lightGray = [248, 249, 250];

                // Header Background
                doc.setFillColor(...primaryColor);
                doc.rect(0, 0, 210, 50, 'F');
                
                // Title and emoji
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(28);
                doc.setFont('helvetica', 'bold');
                doc.text(theme.name, 105, 25, { align: 'center' });
                
                doc.setFontSize(14);
                doc.setFont('helvetica', 'normal');
                doc.text(theme.tagline, 105, 35, { align: 'center' });
                doc.text(theme.contact, 105, 43, { align: 'center' });

                // Invoice header
                doc.setTextColor(...darkColor);
                doc.setFontSize(20);
                doc.setFont('helvetica', 'bold');
                doc.text(currentTheme === 'witchcraft' ? 'INVOICE' : 'INVOICE', 20, 70);
                
                doc.setFontSize(11);
                doc.setFont('helvetica', 'normal');
                doc.text(`${currentTheme === 'witchcraft' ? 'Service' : 'Bill'} Date: ${new Date(data.billDate).toLocaleDateString('en-IN')}`, 20, 82);
                doc.text(`${currentTheme === 'witchcraft' ? 'Invoice' : 'Bill'} No: ${theme.name.substring(0,2)}-${Date.now().toString().slice(-6)}`, 20, 92);
                
                if (data.guaranteeDate) {
                    doc.text(`${currentTheme === 'witchcraft' ? 'Warranty' : 'Guarantee'} Till: ${new Date(data.guaranteeDate).toLocaleDateString('en-IN')}`, 20, 102);
                }

                if (data.projectType) {
                    doc.text(`${currentTheme === 'witchcraft' ? 'Service' : 'Project'} Type: ${data.projectType}`, 20, 112);
                }

                // Payment Status Stamp
                const stampX = 145;
                const stampY = 65;
                if (data.paymentStatus === 'PAID') {
                    doc.setDrawColor(76, 175, 80);
                    doc.setTextColor(76, 175, 80);
                } else {
                    doc.setDrawColor(244, 67, 54);
                    doc.setTextColor(244, 67, 54);
                }
                doc.setLineWidth(3);
                doc.rect(stampX, stampY, 45, 18);
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                const statusText = currentTheme === 'witchcraft' ? 
                    (data.paymentStatus === 'PAID' ? 'PAID' : 'PENDING') : 
                    data.paymentStatus;
                doc.text(statusText, stampX + 22.5, stampY + 12, { align: 'center' });

                // Customer Information Box
                doc.setFillColor(...lightGray);
                doc.rect(20, 125, 170, 45, 'F');
                doc.setDrawColor(...primaryColor);
                doc.setLineWidth(1);
                doc.rect(20, 125, 170, 45);

                doc.setTextColor(...darkColor);
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text(currentTheme === 'witchcraft' ? 'CLIENT:' : 'BILL TO:', 25, 138);
                
                doc.setFontSize(12);
                doc.setFont('helvetica', 'normal');
                doc.text(data.customerName, 25, 150);
                if (data.customerPhone) {
                    doc.text(`Phone: ${data.customerPhone}`, 25, 160);
                }
                if (data.customerEmail) {
                    doc.text(`Email: ${data.customerEmail}`, 100, 160);
                }
                if (data.customerAddress) {
                    const addressLines = doc.splitTextToSize(data.customerAddress, 80);
                    doc.text(addressLines, 25, 168);
                }

                // Items Table
                let yPos = 190;
                
                // Table Header
                doc.setFillColor(...primaryColor);
                doc.rect(20, yPos - 10, 170, 15, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(11);
                doc.setFont('helvetica', 'bold');
                doc.text(currentTheme === 'witchcraft' ? 'SERVICE/COMPONENT' : 'ITEM/SERVICE', 25, yPos);
                doc.text('RATE (Rs)', 110, yPos);
                doc.text('QTY', 140, yPos);
                doc.text('TOTAL (Rs)', 165, yPos);

                yPos += 20;

                // Items
                doc.setTextColor(...darkColor);
                doc.setFont('helvetica', 'normal');
                
                data.items.forEach((item, index) => {
                    if (yPos > 250) {
                        doc.addPage();
                        yPos = 30;
                    }
                    
                    // Alternate row colors
                    if (index % 2 === 0) {
                        doc.setFillColor(248, 249, 250);
                        doc.rect(20, yPos - 8, 170, 12, 'F');
                    }
                    
                    doc.text(item.name.substring(0, 25), 25, yPos);
                    doc.text(`Rs${item.cost.toFixed(2)}`, 110, yPos);
                    doc.text(item.qty.toString(), 140, yPos);
                    doc.text(`Rs${item.itemTotal.toFixed(2)}`, 165, yPos);
                    
                    yPos += 12;
                });

                // Total Section
                yPos += 25;
                doc.setFillColor(...accentColor);
                doc.rect(120, yPos - 8, 70, 15, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text('GRAND TOTAL:', 125, yPos);
                doc.text(`Rs${data.grandTotal.toFixed(2)}`, 165, yPos);

                // Footer
                const footerY = 270;
                doc.setTextColor(...darkColor);
                doc.setFontSize(10);
                doc.setFont('helvetica', 'italic');
                const thankYouText = currentTheme === 'witchcraft' ? 
                    'Thank you for choosing WITCHCRAFT!' : 
                    `Thank you for choosing ${theme.name}!`;
                doc.text(thankYouText, 105, footerY, { align: 'center' });
                doc.text(`For support: ${theme.contact.split('|')[0].trim()}`, 105, footerY + 10, { align: 'center' });
                
                // Credits section
                doc.setFontSize(8);
                doc.setTextColor(100, 100, 100);
                doc.text('Made by Souptik', 105, footerY + 20, { align: 'center' });
                doc.text('Website: soup-codes.site', 105, footerY + 27, { align: 'center' });

                // Save PDF and store bill data
                const billNumber = `${theme.name.substring(0,2)}-${Date.now().toString().slice(-6)}`;
                const fileName = `${theme.name}_${currentTheme === 'witchcraft' ? 'Invoice' : 'Bill'}_${data.customerName.replace(/\s+/g, '_')}_${Date.now()}.pdf`;
                doc.save(fileName);
                
                // Store bill data for warranty linking
                saveBillData({
                    billNumber,
                    customerName: data.customerName,
                    customerPhone: data.customerPhone,
                    customerAddress: data.customerAddress,
                    items: data.items,
                    total: data.grandTotal,
                    date: data.billDate,
                    theme: currentTheme
                });
                
                // Show WhatsApp sharing option
                const whatsappMessage = `Hi! I've generated a ${currentTheme === 'witchcraft' ? 'invoice' : 'bill'} for ${data.customerName}. Bill No: ${billNumber}. Total: Rs${data.grandTotal.toFixed(2)}`;
                const whatsappUrl = `https://wa.me/918389846113?text=${encodeURIComponent(whatsappMessage)}`;
                
                if (confirm('Bill generated successfully! Would you like to share this information via WhatsApp?')) {
                    window.open(whatsappUrl, '_blank');
                }
                
                document.getElementById('loading').style.display = 'none';
            }, 1500);
        }

        function generateBusinessCard() {
            if (!validateForm()) return;
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('loadingText').textContent = 'Generating your Waterny business card...';
            
            setTimeout(() => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('landscape', 'mm', [85.6, 53.98]); // Standard business card size
                const data = getFormData();
                
                // Theme colors
                const themes = {
                    blue: { bg: [14, 165, 233], accent: [56, 189, 248] },
                    green: { bg: [34, 197, 94], accent: [74, 222, 128] },
                    purple: { bg: [147, 51, 234], accent: [168, 85, 247] },
                    gradient: { bg: [251, 146, 60], accent: [252, 211, 77] }
                };
                
                const selectedTheme = themes[data.theme] || themes.blue;
                
                // Background
                doc.setFillColor(...selectedTheme.bg);
                doc.rect(0, 0, 85.6, 53.98, 'F');
                
                // Accent elements
                doc.setFillColor(...selectedTheme.accent);
                doc.circle(75, 10, 8, 'F');
                doc.circle(10, 45, 5, 'F');
                
                // Content
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text(data.name, 10, 15);
                
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.text(data.title, 10, 22);
                
                if (data.company) {
                    doc.setFontSize(8);
                    doc.text(data.company, 10, 28);
                }
                
                // Contact info
                doc.setFontSize(8);
                let yPos = 35;
                doc.text(`Email: ${data.email}`, 10, yPos);
                yPos += 4;
                doc.text(`Phone: ${data.phone}`, 10, yPos);
                
                if (data.website) {
                    yPos += 4;
                    doc.text(`Web: ${data.website}`, 10, yPos);
                }
                
                if (data.location) {
                    yPos += 4;
                    doc.text(`Location: ${data.location}`, 10, yPos);
                }
                
                // Waterny branding
                doc.setFontSize(10);
                doc.setFont('helvetica', 'bold');
                doc.text('WATERNY', 60, 48);
                
                // Credits (very small)
                doc.setFontSize(6);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(200, 200, 200);
                doc.text('Made by Souptik| soup-codes.site', 5, 52);
                
                // Save
                const fileName = `Waterny_Card_${data.name.replace(/\s+/g, '_')}_${Date.now()}.pdf`;
                doc.save(fileName);
                
                // Show WhatsApp sharing option
                const whatsappMessage = `Hi! I've created a professional business card for ${data.name}. Contact: ${data.phone} | Email: ${data.email}`;
                const whatsappUrl = `https://wa.me/918389846113?text=${encodeURIComponent(whatsappMessage)}`;
                
                if (confirm('Business card generated successfully! Would you like to share this information via WhatsApp?')) {
                    window.open(whatsappUrl, '_blank');
                }
                
                document.getElementById('loading').style.display = 'none';
            }, 1000);
        }

        function downloadCardAsPNG() {
            alert('PNG download feature coming soon! Please use PDF generation for now.');
        }

        function previewBill() {
            if (!validateForm()) return;
            
            const data = getFormData();
            const theme = themes[currentTheme];
            
            let previewContent = `
                <div style="text-align: center; background: ${currentTheme === 'witchcraft' ? 'linear-gradient(135deg, #2d1b69, #8b5cf6)' : 'linear-gradient(135deg, #667eea, #764ba2)'}; color: white; padding: 30px;">
                    <h1 style="font-size: 2.5em;">${theme.name}</h1>
                    <h2>${theme.tagline}</h2>
                </div>
                <div style="padding: 20px; font-family: Arial, sans-serif;">
                    <h3>${currentTheme === 'witchcraft' ? 'Client Information' : 'Customer Information'}</h3>
                    <p><strong>Name:</strong> ${data.customerName}</p>
                    <p><strong>Phone:</strong> ${data.customerPhone || 'N/A'}</p>
                    <p><strong>Email:</strong> ${data.customerEmail || 'N/A'}</p>
                    <p><strong>Address:</strong> ${data.customerAddress || 'N/A'}</p>
                    <p><strong>Date:</strong> ${new Date(data.billDate).toLocaleDateString('en-IN')}</p>
                    <p><strong>Status:</strong> ${data.paymentStatus}</p>
                    ${data.projectType ? `<p><strong>Type:</strong> ${data.projectType}</p>` : ''}
                    <hr>
                    <h3>${currentTheme === 'witchcraft' ? 'Services & Components:' : 'Items & Services:'}</h3>
            `;
            
            data.items.forEach((item, index) => {
                previewContent += `
                    <p>${index + 1}. ${item.name} - Rs${item.cost} × ${item.qty} = Rs${item.itemTotal.toFixed(2)}</p>
                `;
            });
            
            previewContent += `
                <hr>
                <p style="font-size: 1.2em;"><strong>Grand Total: Rs${data.grandTotal.toFixed(2)}</strong></p>
                <hr>
                <p style="text-align: center; color: #666; font-style: italic;">
                    ${currentTheme === 'witchcraft' ? 'Thank you for choosing WITCHCRAFT!' : 'Thank you for choosing ' + theme.name + '!'}
                </p>
            `;
            
            const previewWindow = window.open('', 'Preview', 'width=600,height=800');
            previewWindow.document.write(`
                <html>
                    <head>
                        <title>${currentTheme === 'witchcraft' ? 'Invoice' : 'Bill'} Preview</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; margin: 0; }
                            .no-print { margin: 20px 0; text-align: center; }
                            @media print { .no-print { display: none; } }
                        </style>
                    </head>
                    <body>
                        <div class="no-print">
                            <button onclick="window.print()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">Print Preview</button>
                        </div>
                        ${previewContent}
                    </body>
                </html>
            `);
        }

        function generateWarrantyPDF() {
            const customerName = document.getElementById('customerName')?.value;
            const customerPhone = document.getElementById('customerPhone')?.value;
            const customerAddress = document.getElementById('customerAddress')?.value;
            const billNumber = document.getElementById('billNumber')?.value;
            const purchaseDate = document.getElementById('purchaseDate')?.value;
            const productName = document.getElementById('productName')?.value;
            const warrantyPeriod = document.getElementById('warrantyPeriod')?.value;

            if (!customerName || !customerPhone || !customerAddress || !billNumber || !purchaseDate || !productName || !warrantyPeriod) {
                alert('Please fill in all required fields');
                return;
            }

            document.getElementById('loading').style.display = 'block';
            document.getElementById('loadingText').textContent = 'Generating warranty card PDF...';
            
            setTimeout(() => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // SILITECH branding colors
                const primaryColor = [102, 126, 234];
                const accentColor = [78, 205, 196];
                const darkColor = [44, 62, 80];
                const lightGray = [248, 249, 250];
                
                // Header Background
                doc.setFillColor(...primaryColor);
                doc.rect(0, 0, 210, 60, 'F');
                
                // Title
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(32);
                doc.setFont('helvetica', 'bold');
                doc.text('SILITECH', 105, 30, { align: 'center' });
                
                doc.setFontSize(18);
                doc.setFont('helvetica', 'normal');
                doc.text('WARRANTY CARD', 105, 45, { align: 'center' });
                
                doc.setFontSize(12);
                doc.text('Powering Tomorrow, Today', 105, 55, { align: 'center' });

                // Warranty Card Information Box
                doc.setFillColor(...lightGray);
                doc.rect(20, 80, 170, 120, 'F');
                doc.setDrawColor(...primaryColor);
                doc.setLineWidth(2);
                doc.rect(20, 80, 170, 120);

                doc.setTextColor(...darkColor);
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                doc.text('WARRANTY DETAILS', 105, 95, { align: 'center' });

                // Customer Information
                let yPos = 115;
                doc.setFontSize(12);
                doc.setFont('helvetica', 'bold');
                doc.text('Customer Name:', 30, yPos);
                doc.setFont('helvetica', 'normal');
                doc.text(customerName, 80, yPos);

                yPos += 15;
                doc.setFont('helvetica', 'bold');
                doc.text('Phone Number:', 30, yPos);
                doc.setFont('helvetica', 'normal');
                doc.text(customerPhone, 80, yPos);

                yPos += 15;
                doc.setFont('helvetica', 'bold');
                doc.text('Address:', 30, yPos);
                doc.setFont('helvetica', 'normal');
                const addressLines = doc.splitTextToSize(customerAddress, 100);
                doc.text(addressLines, 80, yPos);

                yPos += 20;
                doc.setFont('helvetica', 'bold');
                doc.text('Product Name:', 30, yPos);
                doc.setFont('helvetica', 'normal');
                doc.text(productName, 80, yPos);

                yPos += 15;
                doc.setFont('helvetica', 'bold');
                doc.text('Bill Number:', 30, yPos);
                doc.setFont('helvetica', 'normal');
                doc.text(billNumber, 80, yPos);

                yPos += 15;
                doc.setFont('helvetica', 'bold');
                doc.text('Purchase Date:', 30, yPos);
                doc.setFont('helvetica', 'normal');
                doc.text(new Date(purchaseDate).toLocaleDateString('en-IN'), 80, yPos);

                yPos += 15;
                doc.setFont('helvetica', 'bold');
                doc.text('Warranty Period:', 30, yPos);
                doc.setFont('helvetica', 'normal');
                doc.text(warrantyPeriod + ' months', 80, yPos);

                // Calculate warranty expiry date
                const expiryDate = new Date(purchaseDate);
                expiryDate.setMonth(expiryDate.getMonth() + parseInt(warrantyPeriod));
                
                yPos += 15;
                doc.setFont('helvetica', 'bold');
                doc.text('Warranty Expires:', 30, yPos);
                doc.setFont('helvetica', 'normal');
                doc.text(expiryDate.toLocaleDateString('en-IN'), 80, yPos);

                // Verification Code Section
                const verificationCode = generateVerificationCode(billNumber, customerName);
                doc.setFillColor(...accentColor);
                doc.rect(20, 220, 170, 30, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text('VERIFICATION CODE:', 30, 235);
                doc.setFontSize(16);
                doc.text(verificationCode, 30, 245);

                // WhatsApp Button Info
                doc.setTextColor(...darkColor);
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.text('For warranty claims, contact us on WhatsApp: +91 8389846113', 105, 260, { align: 'center' });
                doc.text('Include this verification code in your message for faster processing', 105, 270, { align: 'center' });

                // Footer
                doc.setFontSize(8);
                doc.setTextColor(100, 100, 100);
                doc.text('This warranty card is valid only with original purchase receipt', 105, 285, { align: 'center' });
                doc.text('Made by Souptik/soup-codes.site', 105, 292, { align: 'center' });

                // Save the warranty data
                const warrantyData = {
                    customerName,
                    customerPhone,
                    customerAddress,
                    billNumber,
                    purchaseDate,
                    productName,
                    warrantyPeriod,
                    verificationCode,
                    issueDate: new Date().toISOString(),
                    expiryDate: expiryDate.toISOString()
                };
                
                // Save to localStorage for tracking
                const existingWarranties = JSON.parse(localStorage.getItem('warranties') || '[]');
                existingWarranties.push(warrantyData);
                localStorage.setItem('warranties', JSON.stringify(existingWarranties));

                // Save PDF
                const fileName = `SILITECH_Warranty_Card_${customerName.replace(/\s+/g, '_')}_${Date.now()}.pdf`;
                doc.save(fileName);
                
                document.getElementById('loading').style.display = 'none';
                
                // Show WhatsApp sharing option
                const whatsappMessage = `Hi! I've generated a warranty card for ${customerName}. Product: ${productName} | Bill No: ${billNumber} | Verification Code: ${verificationCode}`;
                const whatsappUrl = `https://wa.me/918389846113?text=${encodeURIComponent(whatsappMessage)}`;
                
                if (confirm('Warranty card generated successfully! Warranty data has been saved for future reference. Would you like to share this information via WhatsApp?')) {
                    window.open(whatsappUrl, '_blank');
                }
            }, 1500);
        }

        // CSS Loading Detection and Error Handling
        function checkCSSLoaded() {
            try {
                const testElement = document.createElement('div');
                testElement.className = 'container';
                testElement.style.visibility = 'hidden';
                testElement.style.position = 'absolute';
                document.body.appendChild(testElement);
                
                const computedStyle = window.getComputedStyle(testElement);
                const isLoaded = computedStyle.maxWidth === '1200px' || computedStyle.background.includes('white');
                
                document.body.removeChild(testElement);
                
                if (!isLoaded) {
                    console.warn('External CSS may not have loaded properly. Using inline fallback.');
                    // Add additional fallback styles if needed
                }
                
                return isLoaded;
            } catch (error) {
                console.error('CSS loading check failed:', error);
                return false;
            }
        }

        // Check CSS loading after page load
        window.addEventListener('load', function() {
            setTimeout(checkCSSLoaded, 500);
        });

        // Alternative CSS loading method for web deployment
        const cssLink = document.querySelector('link[href*="styles.css"]');
        if (cssLink) {
            cssLink.onerror = function() {
                console.error('Failed to load styles.css');
                // Create and inject critical CSS as backup
                const backupStyle = document.createElement('style');
                backupStyle.textContent = `
                    .theme-card { 
                        background: white; 
                        border-radius: 15px; 
                        overflow: hidden; 
                        box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
                        transition: transform 0.3s ease; 
                        cursor: pointer; 
                    }
                    .theme-preview { 
                        padding: 20px; 
                        text-align: center; 
                    }
                    .theme-btn { 
                        width: 100%; 
                        padding: 15px; 
                        border: none; 
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                        color: white; 
                        font-weight: bold; 
                        cursor: pointer; 
                    }
                `;
                document.head.appendChild(backupStyle);
            };
        }
    </script>
    
</body>
</html>