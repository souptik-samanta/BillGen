<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Theme Bill & Card Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Creepster&family=Nosifer&family=Butcherman&display=swap');
    </style>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Theme Selection Modal -->
    <div id="themeModal" class="modal">
        <div class="modal-content">
            <h2>Choose Your Theme</h2>
            <div class="theme-grid">
                <div class="theme-card" onclick="selectTheme('silitech')">
                    <div class="theme-preview silitech-preview">
                        <h3>SILITECH</h3>
                        <p>Robotics & Electronics</p>
                    </div>
                    <button class="theme-btn">Select SILITECH</button>
                </div>
                
                <div class="theme-card" onclick="selectTheme('witchcraft')">
                    <div class="theme-preview witchcraft-preview">
                        <h3>WITCHCRAFT</h3>
                        <p>Vision Meeting Perfection</p>
                    </div>
                    <button class="theme-btn">Select WITCHCRAFT</button>
                </div>
                
                <div class="theme-card" onclick="selectTheme('waterny')">
                    <div class="theme-preview waterny-preview">
                        <h3>WATERNY BUSINESS CARDS</h3>
                        <p>Professional Digital Business Cards</p>
                    </div>
                    <button class="theme-btn">Create Business Card</button>
                </div>
                
                <div class="theme-card" onclick="selectTheme('warranty')">
                    <div class="theme-preview warranty-preview">
                        <h3>WARRANTY CARD</h3>
                        <p>SILITECH Official Warranty</p>
                    </div>
                    <button class="theme-btn">Select WARRANTY</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container" id="mainContainer" style="display: none;">
        <!-- Dynamic Header will be inserted here -->
        <div class="header" id="dynamicHeader"></div>

        <!-- Theme Switcher Button -->
        <div class="theme-switcher">
            <button class="btn btn-theme" onclick="showThemeModal()">Switch Theme</button>
        </div>

        <!-- Dynamic Form Section -->
        <div class="form-section" id="dynamicForm">
            <!-- Form content will be dynamically generated based on selected theme -->
        </div>

        <!-- Dynamic Actions Section -->
        <div class="actions" id="dynamicActions">
            <!-- Actions will be dynamically generated based on selected theme -->
        </div>

        <div class="love-footer">
            Made  <span class="heart"></span> by Souptik
            <br>
            <small style="opacity: 0.8;">Website: soup-codes.site - Professional Bill & Card Generator</small>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p id="loadingText">Generating your document...</p>
        </div>
    </div>

    <script>
        let currentTheme = 'silitech';
        let itemCount = 1;
        
        // Data storage for bills and sequential numbering
        const DATA_STORAGE_KEY = 'billgen_data';
        const COUNTERS_KEY = 'billgen_counters';
        
        // Initialize storage
        function initStorage() {
            if (!localStorage.getItem(DATA_STORAGE_KEY)) {
                localStorage.setItem(DATA_STORAGE_KEY, JSON.stringify([]));
            }
            if (!localStorage.getItem(COUNTERS_KEY)) {
                localStorage.setItem(COUNTERS_KEY, JSON.stringify({
                    silitech: 1,
                    witchcraft: 1,
                    warranty: 1
                }));
            }
        }
        
        // Get next bill number
        function getNextBillNumber(theme) {
            const counters = JSON.parse(localStorage.getItem(COUNTERS_KEY));
            const prefix = theme === 'silitech' ? 'ST' : theme === 'witchcraft' ? 'WC' : 'WR';
            const number = counters[theme].toString().padStart(4, '0');
            return `${prefix}-${number}`;
        }
        
        // Update counter
        function updateCounter(theme) {
            const counters = JSON.parse(localStorage.getItem(COUNTERS_KEY));
            counters[theme]++;
            localStorage.setItem(COUNTERS_KEY, JSON.stringify(counters));
        }
        
        // Save bill data
        function saveBillData(billData) {
            const data = JSON.parse(localStorage.getItem(DATA_STORAGE_KEY));
            data.push({
                ...billData,
                timestamp: new Date().toISOString(),
                id: Date.now()
            });
            localStorage.setItem(DATA_STORAGE_KEY, JSON.stringify(data));
        }
        
        // Generate verification barcode (simple encoding with secret key)
        function generateVerificationCode(billNumber) {
            const secretKey = 'SILITECH2024SECURE';
            let encoded = '';
            for (let i = 0; i < billNumber.length; i++) {
                const charCode = billNumber.charCodeAt(i);
                const keyChar = secretKey.charCodeAt(i % secretKey.length);
                encoded += (charCode + keyChar).toString(16).padStart(3, '0');
            }
            return encoded.toUpperCase();
        }

        // Theme configurations
        const themes = {
            silitech: {
                name: 'SILITECH',
                tagline: 'ROBOTICS & ELECTRONICS DEPARTMENT',
                emoji: '',
                contact: 'silitechservices@gmail.com | WP: +91 7439442752',
                colors: {
                    primary: '#667eea',
                    secondary: '#764ba2',
                    accent: '#4ECDC4'
                },
                projectTypes: ['Robotics', 'Electronics', 'IoT Solutions', 'Automation', 'Custom Project']
            },
            witchcraft: {
                name: 'WITCHCRAFT',
                tagline: 'Vision Meeting Perfection',
                emoji: '',
                contact: 'silitechservices@gmail.com | WP: +91 7439442752',
                colors: {
                    primary: '#2d1b69',
                    secondary: '#8b5cf6',
                    accent: '#c084fc'
                },
                projectTypes: ['PCB Design', 'Circuit Analysis', 'Electronic Prototyping', 'Embedded Systems', 'Hardware Testing']
            },
            waterny: {
                name: 'WATERNY BUSINESS CARDS',
                tagline: 'Professional Digital Business Cards & Networking',
                emoji: '',
                contact: 'hello@waterny.com | Phone: +91 8888888888 | Create Your Professional Identity',
                colors: {
                    primary: '#0ea5e9',
                    secondary: '#0284c7',
                    accent: '#38bdf8'
                }
            },
            warranty: {
                name: 'SILITECH WARRANTY',
                tagline: 'Official Warranty Certificate',
                emoji: '',
                contact: 'silitechservices@gmail.com | WP: +91 7439442752',
                colors: {
                    primary: '#28a745',
                    secondary: '#20c997',
                    accent: '#17a2b8'
                }
            }
        };

        // Show theme selection modal on page load
        document.addEventListener('DOMContentLoaded', function() {
            showThemeModal();
        });

        function showThemeModal() {
            document.getElementById('themeModal').style.display = 'flex';
            document.getElementById('mainContainer').style.display = 'none';
        }

        function selectTheme(theme) {
            currentTheme = theme;
            document.getElementById('themeModal').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'block';
            
            if (theme === 'waterny') {
                generateWaternyCardForm();
            } else if (theme === 'warranty') {
                generateWarrantyForm();
            } else {
                generateBillForm();
            }
            generateHeader();
            generateActions();
        }

        function generateHeader() {
            const theme = themes[currentTheme];
            const headerElement = document.getElementById('dynamicHeader');
            
            if (currentTheme === 'witchcraft') {
                headerElement.className = 'header witchcraft-header';
                headerElement.innerHTML = `
                    <div class="mystical-bg"></div>
                    <h1>${theme.name}</h1>
                    <p>${theme.tagline}</p>
                `;
            } else if (currentTheme === 'waterny') {
                headerElement.className = 'header waterny-header';
                headerElement.innerHTML = `
                    <div class="water-bg"></div>
                    <h1>${theme.name}</h1>
                    <p>${theme.tagline}</p>
                    <div class="business-features">
                        <span>üìá Professional Cards</span>
                        <span>üåê Digital Ready</span>
                        <span>üé® Multiple Themes</span>
                    </div>
                `;
            } else if (currentTheme === 'warranty') {
                headerElement.className = 'header warranty-header';
                headerElement.innerHTML = `
                    <h1>${theme.name}</h1>
                    <p>${theme.tagline}</p>
                `;
            } else {
                headerElement.className = 'header silitech-header';
                headerElement.innerHTML = `
                    <h1>${theme.name}</h1>
                    <p>${theme.tagline}</p>
                `;
            }
        }

        function generateBillForm() {
            const theme = themes[currentTheme];
            const formElement = document.getElementById('dynamicForm');
            
            const projectOptions = theme.projectTypes.map(type => 
                `<option value="${type}">${type}</option>`
            ).join('');
            
            formElement.innerHTML = `
                <div class="form-row">
                    <div class="form-group">
                        <label for="customerName">${currentTheme === 'witchcraft' ? 'Client Name *' : 'Customer Name *'}</label>
                        <input type="text" id="customerName" placeholder="${currentTheme === 'witchcraft' ? 'Enter client name' : 'Enter customer name'}" required>
                    </div>
                    <div class="form-group">
                        <label for="customerPhone">${currentTheme === 'witchcraft' ? 'Phone Number' : 'Phone Number'}</label>
                        <input type="tel" id="customerPhone" placeholder="${currentTheme === 'witchcraft' ? 'Enter phone number' : 'Enter phone number'}">
                    </div>
                    <div class="form-group">
                        <label for="customerEmail">${currentTheme === 'witchcraft' ? 'Email Address' : 'Email Address'}</label>
                        <input type="email" id="customerEmail" placeholder="${currentTheme === 'witchcraft' ? 'Enter email address' : 'Enter email address'}">
                    </div>
                </div>

                <div class="form-group">
                    <label for="customerAddress">${currentTheme === 'witchcraft' ? 'Client Address' : 'Customer Address'}</label>
                    <textarea id="customerAddress" rows="3" placeholder="${currentTheme === 'witchcraft' ? 'Enter client address' : 'Enter customer address'}"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="billDate">${currentTheme === 'witchcraft' ? 'Service Date' : 'Bill Date'}</label>
                        <input type="date" id="billDate">
                    </div>
                    <div class="form-group">
                        <label for="guaranteeDate">${currentTheme === 'witchcraft' ? 'Warranty Till' : 'Guarantee Till'}</label>
                        <input type="date" id="guaranteeDate">
                    </div>
                    <div class="form-group">
                        <label for="projectType">${currentTheme === 'witchcraft' ? 'Service Type' : 'Project Type'}</label>
                        <select id="projectType">
                            <option value="">Select Service Type</option>
                            ${projectOptions}
                        </select>
                    </div>
                </div>

                <div class="items-section ${currentTheme}-items">
                    <div class="items-header">
                        <h3>${currentTheme === 'witchcraft' ? 'Services & Components' : 'Items & Services'}</h3>
                        <button type="button" class="btn btn-primary" onclick="addItem()">+ Add Item</button>
                    </div>
                    
                    <div id="itemsContainer">
                        <div class="item-row">
                            <div>
                                <label>${currentTheme === 'witchcraft' ? 'Service/Component Name *' : 'Item/Service Name *'}</label>
                                <input type="text" class="item-name" placeholder="${currentTheme === 'witchcraft' ? 'Enter service or component name' : 'Enter item or service name'}" required>
                            </div>
                            <div>
                                <label>Cost (Rs) *</label>
                                <input type="number" class="item-cost" placeholder="0.00" min="0" step="0.01" required>
                            </div>
                            <div>
                                <label>Quantity *</label>
                                <input type="number" class="item-qty" placeholder="1" min="1" value="1" required>
                            </div>
                            <div>
                                <label>&nbsp;</label>
                                <button type="button" class="btn btn-danger" onclick="removeItem(this)" style="display: none;">√ó</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="payment-status ${currentTheme}-payment">
                    <label><strong>${currentTheme === 'witchcraft' ? 'Payment Status:' : 'Payment Status:'}</strong></label>
                    <div class="radio-group">
                        <input type="radio" id="paid" name="paymentStatus" value="PAID" checked>
                        <label for="paid">${currentTheme === 'witchcraft' ? 'PAID' : 'PAID'}</label>
                    </div>
                    <div class="radio-group">
                        <input type="radio" id="unpaid" name="paymentStatus" value="UNPAID">
                        <label for="unpaid">${currentTheme === 'witchcraft' ? 'UNPAID' : 'UNPAID'}</label>
                    </div>
                </div>

                <div class="summary ${currentTheme}-summary" id="billSummary">
                    <h3>${currentTheme === 'witchcraft' ? 'Bill Summary' : 'Bill Summary'}</h3>
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">Rs 0.00</span>
                    </div>
                    <div class="summary-row total">
                        <span>${currentTheme === 'witchcraft' ? 'Grand Total:' : 'Grand Total:'}</span>
                        <span id="grandTotal">Rs 0.00</span>
                    </div>
                </div>

                <div class="disclaimer">
                    <p>WARNING: This is a demo bill generator for educational purposes. Not for commercial use.</p>
                </div>
            `;
            
            initializeDates();
            attachCalculationListeners();
        }

        function generateWaternyCardForm() {
            const formElement = document.getElementById('dynamicForm');
            
            formElement.innerHTML = `
                <div class="card-preview" id="cardPreview">
                    <div class="business-card waterny-card">
                        <div class="card-front">
                            <div class="card-header">
                                <h2 id="previewName">Your Name</h2>
                                <p id="previewTitle">Your Title</p>
                            </div>
                            <div class="card-body">
                                <div class="contact-info">
                                    <p><span class="icon">Email:</span> <span id="previewEmail">your@email.com</span></p>
                                    <p><span class="icon">Phone:</span> <span id="previewPhone">+91 9999999999</span></p>
                                    <p><span class="icon">Web:</span> <span id="previewWebsite">www.yourwebsite.com</span></p>
                                    <p><span class="icon">Location:</span> <span id="previewLocation">Your Location</span></p>
                                </div>
                            </div>
                            <div class="waterny-logo">WATERNY</div>
                        </div>
                    </div>
                </div>

                <div class="card-form business-card-form">
                    <h2>üé® Create Your Professional Business Card</h2>
                    <p class="form-description">Design a stunning digital business card that makes a lasting impression!</p>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cardName">üë§ Full Name *</label>
                            <input type="text" id="cardName" placeholder="Enter your full name" required>
                        </div>
                        <div class="form-group">
                            <label for="cardTitle">üíº Job Title *</label>
                            <input type="text" id="cardTitle" placeholder="e.g., Senior Developer, Marketing Manager" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="cardEmail">üìß Email Address *</label>
                            <input type="email" id="cardEmail" placeholder="your.name@company.com" required>
                        </div>
                        <div class="form-group">
                            <label for="cardPhone">üì± Phone Number *</label>
                            <input type="tel" id="cardPhone" placeholder="+91 9999999999" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="cardWebsite">üåê Website/LinkedIn</label>
                            <input type="url" id="cardWebsite" placeholder="www.yourwebsite.com or linkedin.com/in/yourname">
                        </div>
                        <div class="form-group">
                            <label for="cardLocation">üìç Location</label>
                            <input type="text" id="cardLocation" placeholder="City, Country">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="cardCompany">üè¢ Company/Organization</label>
                        <input type="text" id="cardCompany" placeholder="Your Amazing Company Ltd.">
                    </div>

                    <div class="card-themes professional-themes">
                        <label><strong>üé® Choose Your Professional Theme:</strong></label>
                        <div class="theme-selector premium-selector">
                            <input type="radio" id="blueTheme" name="cardTheme" value="blue" checked>
                            <label for="blueTheme" class="theme-option blue-theme">
                                <span class="theme-color"></span>
                                <span class="theme-name">Ocean Blue</span>
                                <span class="theme-desc">Professional & Trustworthy</span>
                            </label>
                            
                            <input type="radio" id="greenTheme" name="cardTheme" value="green">
                            <label for="greenTheme" class="theme-option green-theme">
                                <span class="theme-color"></span>
                                <span class="theme-name">Nature Green</span>
                                <span class="theme-desc">Fresh & Eco-Friendly</span>
                            </label>
                            
                            <input type="radio" id="purpleTheme" name="cardTheme" value="purple">
                            <label for="purpleTheme" class="theme-option purple-theme">
                                <span class="theme-color"></span>
                                <span class="theme-name">Royal Purple</span>
                                <span class="theme-desc">Creative & Luxurious</span>
                            </label>
                            
                            <input type="radio" id="gradientTheme" name="cardTheme" value="gradient">
                            <label for="gradientTheme" class="theme-option gradient-theme">
                                <span class="theme-color"></span>
                                <span class="theme-name">Sunset Gradient</span>
                                <span class="theme-desc">Modern & Dynamic</span>
                            </label>
                        </div>
                    </div>
                </div>
            `;
            
            attachCardListeners();
        }

        function generateWarrantyForm() {
            const formElement = document.getElementById('dynamicForm');
            
            formElement.innerHTML = `
                <div class="warranty-form">
                    <h2>Warranty Card Details</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="customerName">Customer Name *</label>
                            <input type="text" id="customerName" placeholder="Enter customer name" required>
                        </div>
                        <div class="form-group">
                            <label for="customerPhone">Phone Number *</label>
                            <input type="tel" id="customerPhone" placeholder="Enter phone number" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="customerAddress">Customer Address *</label>
                        <textarea id="customerAddress" rows="3" placeholder="Enter complete address" required></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="billNumber">Bill Number *</label>
                            <input type="text" id="billNumber" placeholder="Enter linked bill number" required>
                        </div>
                        <div class="form-group">
                            <label for="purchaseDate">Purchase Date *</label>
                            <input type="date" id="purchaseDate" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="productName">Product Name *</label>
                            <input type="text" id="productName" placeholder="Enter product name" required>
                        </div>
                        <div class="form-group">
                            <label for="warrantyPeriod">Warranty Period (months) *</label>
                            <input type="number" id="warrantyPeriod" min="1" max="120" value="12" required>
                        </div>
                    </div>

                    <div class="warranty-preview" id="warrantyPreview">
                        <h3>Warranty Card Preview</h3>
                        <div class="warranty-card-preview">
                            <div class="warranty-header">
                                <h2>SILITECH</h2>
                                <p>WARRANTY CARD</p>
                            </div>
                            <div class="warranty-details">
                                <p><strong>Customer:</strong> <span id="previewCustomerName">Customer Name</span></p>
                                <p><strong>Product:</strong> <span id="previewProductName">Product Name</span></p>
                                <p><strong>Bill No:</strong> <span id="previewBillNumber">Bill Number</span></p>
                                <p><strong>Purchase Date:</strong> <span id="previewPurchaseDate">Purchase Date</span></p>
                                <p><strong>Warranty Period:</strong> <span id="previewWarrantyPeriod">12 months</span></p>
                                <div class="verification-code">
                                    <p><strong>Verification Code:</strong> <span id="previewVerificationCode">VERIFY123</span></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button type="button" class="generate-btn" onclick="generateWarrantyPDF()">Generate Warranty Card PDF</button>
                </div>
            `;
            
            initializeWarrantyDates();
            attachWarrantyListeners();
        }

        function addItem() {
            itemCount++;
            const container = document.getElementById('itemsContainer');
            const newItem = document.createElement('div');
            newItem.className = 'item-row';
            
            const theme = themes[currentTheme];
            newItem.innerHTML = `
                <div>
                    <label>${currentTheme === 'witchcraft' ? 'Service/Component Name *' : 'Item/Service Name *'}</label>
                    <input type="text" class="item-name" placeholder="${currentTheme === 'witchcraft' ? 'Enter service or component name' : 'Enter item or service name'}" required>
                </div>
                <div>
                    <label>Cost (Rs) *</label>
                    <input type="number" class="item-cost" placeholder="0.00" min="0" step="0.01" required>
                </div>
                <div>
                    <label>Quantity *</label>
                    <input type="number" class="item-qty" placeholder="1" min="1" value="1" required>
                </div>
                <div>
                    <label>&nbsp;</label>
                    <button type="button" class="btn btn-danger" onclick="removeItem(this)">√ó</button>
                </div>
            `;
            container.appendChild(newItem);
            updateRemoveButtons();
            attachCalculationListeners(newItem);
        }

        function generateActions() {
            const actionsElement = document.getElementById('dynamicActions');
            
            if (currentTheme === 'waterny') {
                actionsElement.innerHTML = `
                    <button type="button" class="btn btn-success" onclick="generateBusinessCard()" style="margin-right: 20px;">
                        Generate Business Card
                    </button>
                    <button type="button" class="btn btn-primary" onclick="downloadCardAsPNG()">
                        Download as PNG
                    </button>
                `;
            } else {
                actionsElement.innerHTML = `
                    <button type="button" class="btn btn-success" onclick="generatePDF()" style="margin-right: 20px;">
                        Generate PDF ${currentTheme === 'witchcraft' ? 'Invoice' : 'Bill'}
                    </button>
                    <button type="button" class="btn btn-primary" onclick="previewBill()">
                        Preview ${currentTheme === 'witchcraft' ? 'Invoice' : 'Bill'}
                    </button>
                `;
            }
        }

        function initializeDates() {
            const billDate = document.getElementById('billDate');
            const guaranteeDate = document.getElementById('guaranteeDate');
            
            if (billDate) {
                billDate.value = new Date().toISOString().split('T')[0];
            }
            
            if (guaranteeDate) {
                const future = new Date();
                future.setMonth(future.getMonth() + 1);
                guaranteeDate.value = future.toISOString().split('T')[0];
            }
        }

        function attachCardListeners() {
            const inputs = ['cardName', 'cardTitle', 'cardEmail', 'cardPhone', 'cardWebsite', 'cardLocation'];
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', updateCardPreview);
                }
            });
            
            const themeInputs = document.querySelectorAll('input[name="cardTheme"]');
            themeInputs.forEach(input => {
                input.addEventListener('change', updateCardTheme);
            });
        }

        function updateCardPreview() {
            const name = document.getElementById('cardName')?.value || 'Your Name';
            const title = document.getElementById('cardTitle')?.value || 'Your Title';
            const email = document.getElementById('cardEmail')?.value || 'your@email.com';
            const phone = document.getElementById('cardPhone')?.value || '+91 9999999999';
            const website = document.getElementById('cardWebsite')?.value || 'www.yourwebsite.com';
            const location = document.getElementById('cardLocation')?.value || 'Your Location';

            document.getElementById('previewName').textContent = name;
            document.getElementById('previewTitle').textContent = title;
            document.getElementById('previewEmail').textContent = email;
            document.getElementById('previewPhone').textContent = phone;
            document.getElementById('previewWebsite').textContent = website;
            document.getElementById('previewLocation').textContent = location;
        }

        function updateCardTheme() {
            const selectedTheme = document.querySelector('input[name="cardTheme"]:checked').value;
            const card = document.querySelector('.waterny-card');
            card.className = `business-card waterny-card ${selectedTheme}-card`;
        }

        function removeItem(button) {
            if (itemCount > 1) {
                button.closest('.item-row').remove();
                itemCount--;
                updateRemoveButtons();
                calculateTotals();
            }
        }

        function updateRemoveButtons() {
            const removeButtons = document.querySelectorAll('.btn-danger');
            removeButtons.forEach((btn, index) => {
                btn.style.display = itemCount > 1 ? 'block' : 'none';
            });
        }

        function initializeWarrantyDates() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('purchaseDate').value = today;
        }

        function attachWarrantyListeners() {
            const inputs = ['customerName', 'productName', 'billNumber', 'purchaseDate', 'warrantyPeriod'];
            
            inputs.forEach(inputId => {
                const element = document.getElementById(inputId);
                if (element) {
                    element.addEventListener('input', updateWarrantyPreview);
                }
            });
            
            updateWarrantyPreview();
        }

        function updateWarrantyPreview() {
            const customerName = document.getElementById('customerName')?.value || 'Customer Name';
            const productName = document.getElementById('productName')?.value || 'Product Name';
            const billNumber = document.getElementById('billNumber')?.value || 'Bill Number';
            const purchaseDate = document.getElementById('purchaseDate')?.value || 'Purchase Date';
            const warrantyPeriod = document.getElementById('warrantyPeriod')?.value || '12';
            
            // Update preview elements
            const previewCustomerName = document.getElementById('previewCustomerName');
            const previewProductName = document.getElementById('previewProductName');
            const previewBillNumber = document.getElementById('previewBillNumber');
            const previewPurchaseDate = document.getElementById('previewPurchaseDate');
            const previewWarrantyPeriod = document.getElementById('previewWarrantyPeriod');
            const previewVerificationCode = document.getElementById('previewVerificationCode');
            
            if (previewCustomerName) previewCustomerName.textContent = customerName;
            if (previewProductName) previewProductName.textContent = productName;
            if (previewBillNumber) previewBillNumber.textContent = billNumber;
            if (previewPurchaseDate) previewPurchaseDate.textContent = purchaseDate;
            if (previewWarrantyPeriod) previewWarrantyPeriod.textContent = warrantyPeriod + ' months';
            
            // Generate verification code
            if (billNumber && customerName) {
                const verificationCode = generateVerificationCode(billNumber, customerName);
                if (previewVerificationCode) previewVerificationCode.textContent = verificationCode;
            }
        }

        function attachCalculationListeners(container = document) {
            const inputs = container.querySelectorAll('.item-cost, .item-qty');
            inputs.forEach(input => {
                input.addEventListener('input', calculateTotals);
            });
        }

        function calculateTotals() {
            if (currentTheme === 'waterny') return;
            
            let total = 0;
            const itemRows = document.querySelectorAll('.item-row');
            
            itemRows.forEach(row => {
                const cost = parseFloat(row.querySelector('.item-cost')?.value) || 0;
                const qty = parseInt(row.querySelector('.item-qty')?.value) || 0;
                const itemTotal = cost * qty;
                total += itemTotal;
            });

            const subtotalElement = document.getElementById('subtotal');
            const grandTotalElement = document.getElementById('grandTotal');
            
            if (subtotalElement) subtotalElement.textContent = `Rs ${total.toFixed(2)}`;
            if (grandTotalElement) grandTotalElement.textContent = `Rs ${total.toFixed(2)}`;
        }

        function validateForm() {
            if (currentTheme === 'waterny') {
                const name = document.getElementById('cardName')?.value.trim();
                const title = document.getElementById('cardTitle')?.value.trim();
                const email = document.getElementById('cardEmail')?.value.trim();
                const phone = document.getElementById('cardPhone')?.value.trim();
                
                if (!name || !title || !email || !phone) {
                    alert('Please fill in all required fields (Name, Title, Email, Phone)');
                    return false;
                }
                return true;
            }
            
            const customerName = document.getElementById('customerName')?.value.trim();
            if (!customerName) {
                alert(currentTheme === 'witchcraft' ? 'Please enter the client name' : 'Please enter customer name');
                return false;
            }

            const itemRows = document.querySelectorAll('.item-row');
            for (let row of itemRows) {
                const name = row.querySelector('.item-name')?.value.trim();
                const cost = row.querySelector('.item-cost')?.value;
                const qty = row.querySelector('.item-qty')?.value;
                
                if (!name || !cost || !qty) {
                    alert('Please fill in all required item fields');
                    return false;
                }
            }
            return true;
        }

        function getFormData() {
            if (currentTheme === 'waterny') {
                return {
                    name: document.getElementById('cardName')?.value.trim(),
                    title: document.getElementById('cardTitle')?.value.trim(),
                    email: document.getElementById('cardEmail')?.value.trim(),
                    phone: document.getElementById('cardPhone')?.value.trim(),
                    website: document.getElementById('cardWebsite')?.value.trim(),
                    location: document.getElementById('cardLocation')?.value.trim(),
                    company: document.getElementById('cardCompany')?.value.trim(),
                    theme: document.querySelector('input[name="cardTheme"]:checked')?.value || 'blue'
                };
            }
            
            const items = [];
            const itemRows = document.querySelectorAll('.item-row');
            
            itemRows.forEach(row => {
                const name = row.querySelector('.item-name')?.value.trim();
                const cost = parseFloat(row.querySelector('.item-cost')?.value) || 0;
                const qty = parseInt(row.querySelector('.item-qty')?.value) || 1;
                
                if (name && cost > 0) {
                    const itemTotal = cost * qty;
                    items.push({ name, cost, qty, itemTotal });
                }
            });

            const grandTotal = items.reduce((sum, item) => sum + item.itemTotal, 0);

            return {
                customerName: document.getElementById('customerName')?.value.trim(),
                customerPhone: document.getElementById('customerPhone')?.value.trim(),
                customerEmail: document.getElementById('customerEmail')?.value.trim(),
                customerAddress: document.getElementById('customerAddress')?.value.trim(),
                billDate: document.getElementById('billDate')?.value,
                guaranteeDate: document.getElementById('guaranteeDate')?.value,
                projectType: document.getElementById('projectType')?.value,
                paymentStatus: document.querySelector('input[name="paymentStatus"]:checked')?.value,
                items,
                grandTotal
            };
        }

        function generatePDF() {
            if (!validateForm()) return;

            document.getElementById('loading').style.display = 'block';
            document.getElementById('loadingText').textContent = 
                currentTheme === 'witchcraft' ? 'Generating your professional invoice...' : 'Generating your professional bill...';
            
            setTimeout(() => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const data = getFormData();
                const theme = themes[currentTheme];

                // Theme-specific colors
                let primaryColor, accentColor, darkColor;
                if (currentTheme === 'witchcraft') {
                    primaryColor = [45, 27, 105];
                    accentColor = [139, 92, 246];
                    darkColor = [30, 20, 60];
                } else {
                    primaryColor = [102, 126, 234];
                    accentColor = [78, 205, 196];
                    darkColor = [44, 62, 80];
                }

                const lightGray = [248, 249, 250];

                // Header Background
                doc.setFillColor(...primaryColor);
                doc.rect(0, 0, 210, 50, 'F');
                
                // Title and emoji
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(28);
                doc.setFont('helvetica', 'bold');
                doc.text(theme.name, 105, 25, { align: 'center' });
                
                doc.setFontSize(14);
                doc.setFont('helvetica', 'normal');
                doc.text(theme.tagline, 105, 35, { align: 'center' });
                doc.text(theme.contact, 105, 43, { align: 'center' });

                // Invoice header
                doc.setTextColor(...darkColor);
                doc.setFontSize(20);
                doc.setFont('helvetica', 'bold');
                doc.text(currentTheme === 'witchcraft' ? 'INVOICE' : 'INVOICE', 20, 70);
                
                doc.setFontSize(11);
                doc.setFont('helvetica', 'normal');
                doc.text(`${currentTheme === 'witchcraft' ? 'Service' : 'Bill'} Date: ${new Date(data.billDate).toLocaleDateString('en-IN')}`, 20, 82);
                doc.text(`${currentTheme === 'witchcraft' ? 'Invoice' : 'Bill'} No: ${theme.name.substring(0,2)}-${Date.now().toString().slice(-6)}`, 20, 92);
                
                if (data.guaranteeDate) {
                    doc.text(`${currentTheme === 'witchcraft' ? 'Warranty' : 'Guarantee'} Till: ${new Date(data.guaranteeDate).toLocaleDateString('en-IN')}`, 20, 102);
                }

                if (data.projectType) {
                    doc.text(`${currentTheme === 'witchcraft' ? 'Service' : 'Project'} Type: ${data.projectType}`, 20, 112);
                }

                // Payment Status Stamp
                const stampX = 145;
                const stampY = 65;
                if (data.paymentStatus === 'PAID') {
                    doc.setDrawColor(76, 175, 80);
                    doc.setTextColor(76, 175, 80);
                } else {
                    doc.setDrawColor(244, 67, 54);
                    doc.setTextColor(244, 67, 54);
                }
                doc.setLineWidth(3);
                doc.rect(stampX, stampY, 45, 18);
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                const statusText = currentTheme === 'witchcraft' ? 
                    (data.paymentStatus === 'PAID' ? 'BLESSED' : 'PENDING') : 
                    data.paymentStatus;
                doc.text(statusText, stampX + 22.5, stampY + 12, { align: 'center' });

                // Customer Information Box
                doc.setFillColor(...lightGray);
                doc.rect(20, 125, 170, 45, 'F');
                doc.setDrawColor(...primaryColor);
                doc.setLineWidth(1);
                doc.rect(20, 125, 170, 45);

                doc.setTextColor(...darkColor);
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text(currentTheme === 'witchcraft' ? 'CLIENT:' : 'BILL TO:', 25, 138);
                
                doc.setFontSize(12);
                doc.setFont('helvetica', 'normal');
                doc.text(data.customerName, 25, 150);
                if (data.customerPhone) {
                    doc.text(`Phone: ${data.customerPhone}`, 25, 160);
                }
                if (data.customerEmail) {
                    doc.text(`Email: ${data.customerEmail}`, 100, 160);
                }
                if (data.customerAddress) {
                    const addressLines = doc.splitTextToSize(data.customerAddress, 80);
                    doc.text(addressLines, 25, 168);
                }

                // Items Table
                let yPos = 190;
                
                // Table Header
                doc.setFillColor(...primaryColor);
                doc.rect(20, yPos - 10, 170, 15, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(11);
                doc.setFont('helvetica', 'bold');
                doc.text(currentTheme === 'witchcraft' ? 'SERVICE/COMPONENT' : 'ITEM/SERVICE', 25, yPos);
                doc.text('RATE (Rs)', 110, yPos);
                doc.text('QTY', 140, yPos);
                doc.text('TOTAL (Rs)', 165, yPos);

                yPos += 20;

                // Items
                doc.setTextColor(...darkColor);
                doc.setFont('helvetica', 'normal');
                
                data.items.forEach((item, index) => {
                    if (yPos > 250) {
                        doc.addPage();
                        yPos = 30;
                    }
                    
                    // Alternate row colors
                    if (index % 2 === 0) {
                        doc.setFillColor(248, 249, 250);
                        doc.rect(20, yPos - 8, 170, 12, 'F');
                    }
                    
                    doc.text(item.name.substring(0, 25), 25, yPos);
                    doc.text(`Rs${item.cost.toFixed(2)}`, 110, yPos);
                    doc.text(item.qty.toString(), 140, yPos);
                    doc.text(`Rs${item.itemTotal.toFixed(2)}`, 165, yPos);
                    
                    yPos += 12;
                });

                // Total Section
                yPos += 25;
                doc.setFillColor(...accentColor);
                doc.rect(120, yPos - 8, 70, 15, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text('GRAND TOTAL:', 125, yPos);
                doc.text(`Rs${data.grandTotal.toFixed(2)}`, 165, yPos);

                // Footer
                const footerY = 270;
                doc.setTextColor(...darkColor);
                doc.setFontSize(10);
                doc.setFont('helvetica', 'italic');
                const thankYouText = currentTheme === 'witchcraft' ? 
                    'Thank you for choosing WITCHCRAFT Electronics!' : 
                    `Thank you for choosing ${theme.name}!`;
                doc.text(thankYouText, 105, footerY, { align: 'center' });
                doc.text(`For support: ${theme.contact.split('|')[0].trim()}`, 105, footerY + 10, { align: 'center' });
                
                // Credits section
                doc.setFontSize(8);
                doc.setTextColor(100, 100, 100);
                doc.text('Made by Souptik', 105, footerY + 20, { align: 'center' });
                doc.text('Website: soup-codes.site', 105, footerY + 27, { align: 'center' });

                // Save PDF and store bill data
                const billNumber = `${theme.name.substring(0,2)}-${Date.now().toString().slice(-6)}`;
                const fileName = `${theme.name}_${currentTheme === 'witchcraft' ? 'Invoice' : 'Bill'}_${data.customerName.replace(/\s+/g, '_')}_${Date.now()}.pdf`;
                doc.save(fileName);
                
                // Store bill data for warranty linking
                saveBillData({
                    billNumber,
                    customerName: data.customerName,
                    customerPhone: data.customerPhone,
                    customerAddress: data.customerAddress,
                    items: data.items,
                    total: data.grandTotal,
                    date: data.billDate,
                    theme: currentTheme
                });
                
                // Show WhatsApp sharing option
                const whatsappMessage = `Hi! I've generated a ${currentTheme === 'witchcraft' ? 'invoice' : 'bill'} for ${data.customerName}. Bill No: ${billNumber}. Total: Rs${data.grandTotal.toFixed(2)}`;
                const whatsappUrl = `https://wa.me/918389846113?text=${encodeURIComponent(whatsappMessage)}`;
                
                if (confirm('Bill generated successfully! Would you like to share this information via WhatsApp?')) {
                    window.open(whatsappUrl, '_blank');
                }
                
                document.getElementById('loading').style.display = 'none';
            }, 1500);
        }

        function generateBusinessCard() {
            if (!validateForm()) return;
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('loadingText').textContent = 'Generating your Waterny business card...';
            
            setTimeout(() => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('landscape', 'mm', [85.6, 53.98]); // Standard business card size
                const data = getFormData();
                
                // Theme colors
                const themes = {
                    blue: { bg: [14, 165, 233], accent: [56, 189, 248] },
                    green: { bg: [34, 197, 94], accent: [74, 222, 128] },
                    purple: { bg: [147, 51, 234], accent: [168, 85, 247] },
                    gradient: { bg: [251, 146, 60], accent: [252, 211, 77] }
                };
                
                const selectedTheme = themes[data.theme] || themes.blue;
                
                // Background
                doc.setFillColor(...selectedTheme.bg);
                doc.rect(0, 0, 85.6, 53.98, 'F');
                
                // Accent elements
                doc.setFillColor(...selectedTheme.accent);
                doc.circle(75, 10, 8, 'F');
                doc.circle(10, 45, 5, 'F');
                
                // Content
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text(data.name, 10, 15);
                
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.text(data.title, 10, 22);
                
                if (data.company) {
                    doc.setFontSize(8);
                    doc.text(data.company, 10, 28);
                }
                
                // Contact info
                doc.setFontSize(8);
                let yPos = 35;
                doc.text(`Email: ${data.email}`, 10, yPos);
                yPos += 4;
                doc.text(`Phone: ${data.phone}`, 10, yPos);
                
                if (data.website) {
                    yPos += 4;
                    doc.text(`Web: ${data.website}`, 10, yPos);
                }
                
                if (data.location) {
                    yPos += 4;
                    doc.text(`Location: ${data.location}`, 10, yPos);
                }
                
                // Waterny branding
                doc.setFontSize(10);
                doc.setFont('helvetica', 'bold');
                doc.text('WATERNY', 60, 48);
                
                // Credits (very small)
                doc.setFontSize(6);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(200, 200, 200);
                doc.text('Made by Souptik| soup-codes.site', 5, 52);
                
                // Save
                const fileName = `Waterny_Card_${data.name.replace(/\s+/g, '_')}_${Date.now()}.pdf`;
                doc.save(fileName);
                
                // Show WhatsApp sharing option
                const whatsappMessage = `Hi! I've created a professional business card for ${data.name}. Contact: ${data.phone} | Email: ${data.email}`;
                const whatsappUrl = `https://wa.me/918389846113?text=${encodeURIComponent(whatsappMessage)}`;
                
                if (confirm('Business card generated successfully! Would you like to share this information via WhatsApp?')) {
                    window.open(whatsappUrl, '_blank');
                }
                
                document.getElementById('loading').style.display = 'none';
            }, 1000);
        }

        function downloadCardAsPNG() {
            alert('PNG download feature coming soon! Please use PDF generation for now.');
        }

        function previewBill() {
            if (!validateForm()) return;
            
            const data = getFormData();
            const theme = themes[currentTheme];
            
            let previewContent = `
                <div style="text-align: center; background: ${currentTheme === 'witchcraft' ? 'linear-gradient(135deg, #2d1b69, #8b5cf6)' : 'linear-gradient(135deg, #667eea, #764ba2)'}; color: white; padding: 30px;">
                    <h1 style="font-size: 2.5em;">${theme.name}</h1>
                    <h2>${theme.tagline}</h2>
                </div>
                <div style="padding: 20px; font-family: Arial, sans-serif;">
                    <h3>${currentTheme === 'witchcraft' ? 'Client Information' : 'Customer Information'}</h3>
                    <p><strong>Name:</strong> ${data.customerName}</p>
                    <p><strong>Phone:</strong> ${data.customerPhone || 'N/A'}</p>
                    <p><strong>Email:</strong> ${data.customerEmail || 'N/A'}</p>
                    <p><strong>Address:</strong> ${data.customerAddress || 'N/A'}</p>
                    <p><strong>Date:</strong> ${new Date(data.billDate).toLocaleDateString('en-IN')}</p>
                    <p><strong>Status:</strong> ${data.paymentStatus}</p>
                    ${data.projectType ? `<p><strong>Type:</strong> ${data.projectType}</p>` : ''}
                    <hr>
                    <h3>${currentTheme === 'witchcraft' ? 'Services & Components:' : 'Items & Services:'}</h3>
            `;
            
            data.items.forEach((item, index) => {
                previewContent += `
                    <p>${index + 1}. ${item.name} - Rs${item.cost} √ó ${item.qty} = Rs${item.itemTotal.toFixed(2)}</p>
                `;
            });
            
            previewContent += `
                <hr>
                <p style="font-size: 1.2em;"><strong>Grand Total: Rs${data.grandTotal.toFixed(2)}</strong></p>
                <hr>
                <p style="text-align: center; color: #666; font-style: italic;">
                    ${currentTheme === 'witchcraft' ? 'Thank you for choosing WITCHCRAFT Electronics!' : 'Thank you for choosing ' + theme.name + '!'}
                </p>
            `;
            
            const previewWindow = window.open('', 'Preview', 'width=600,height=800');
            previewWindow.document.write(`
                <html>
                    <head>
                        <title>${currentTheme === 'witchcraft' ? 'Invoice' : 'Bill'} Preview</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; margin: 0; }
                            .no-print { margin: 20px 0; text-align: center; }
                            @media print { .no-print { display: none; } }
                        </style>
                    </head>
                    <body>
                        <div class="no-print">
                            <button onclick="window.print()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">Print Preview</button>
                        </div>
                        ${previewContent}
                    </body>
                </html>
            `);
        }

        function generateWarrantyPDF() {
            const customerName = document.getElementById('customerName')?.value;
            const customerPhone = document.getElementById('customerPhone')?.value;
            const customerAddress = document.getElementById('customerAddress')?.value;
            const billNumber = document.getElementById('billNumber')?.value;
            const purchaseDate = document.getElementById('purchaseDate')?.value;
            const productName = document.getElementById('productName')?.value;
            const warrantyPeriod = document.getElementById('warrantyPeriod')?.value;

            if (!customerName || !customerPhone || !customerAddress || !billNumber || !purchaseDate || !productName || !warrantyPeriod) {
                alert('Please fill in all required fields');
                return;
            }

            document.getElementById('loading').style.display = 'block';
            document.getElementById('loadingText').textContent = 'Generating warranty card PDF...';
            
            setTimeout(() => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // SILITECH branding colors
                const primaryColor = [102, 126, 234];
                const accentColor = [78, 205, 196];
                const darkColor = [44, 62, 80];
                const lightGray = [248, 249, 250];
                
                // Header Background
                doc.setFillColor(...primaryColor);
                doc.rect(0, 0, 210, 60, 'F');
                
                // Title
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(32);
                doc.setFont('helvetica', 'bold');
                doc.text('SILITECH', 105, 30, { align: 'center' });
                
                doc.setFontSize(18);
                doc.setFont('helvetica', 'normal');
                doc.text('WARRANTY CARD', 105, 45, { align: 'center' });
                
                doc.setFontSize(12);
                doc.text('Powering Tomorrow, Today', 105, 55, { align: 'center' });

                // Warranty Card Information Box
                doc.setFillColor(...lightGray);
                doc.rect(20, 80, 170, 120, 'F');
                doc.setDrawColor(...primaryColor);
                doc.setLineWidth(2);
                doc.rect(20, 80, 170, 120);

                doc.setTextColor(...darkColor);
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                doc.text('WARRANTY DETAILS', 105, 95, { align: 'center' });

                // Customer Information
                let yPos = 115;
                doc.setFontSize(12);
                doc.setFont('helvetica', 'bold');
                doc.text('Customer Name:', 30, yPos);
                doc.setFont('helvetica', 'normal');
                doc.text(customerName, 80, yPos);

                yPos += 15;
                doc.setFont('helvetica', 'bold');
                doc.text('Phone Number:', 30, yPos);
                doc.setFont('helvetica', 'normal');
                doc.text(customerPhone, 80, yPos);

                yPos += 15;
                doc.setFont('helvetica', 'bold');
                doc.text('Address:', 30, yPos);
                doc.setFont('helvetica', 'normal');
                const addressLines = doc.splitTextToSize(customerAddress, 100);
                doc.text(addressLines, 80, yPos);

                yPos += 20;
                doc.setFont('helvetica', 'bold');
                doc.text('Product Name:', 30, yPos);
                doc.setFont('helvetica', 'normal');
                doc.text(productName, 80, yPos);

                yPos += 15;
                doc.setFont('helvetica', 'bold');
                doc.text('Bill Number:', 30, yPos);
                doc.setFont('helvetica', 'normal');
                doc.text(billNumber, 80, yPos);

                yPos += 15;
                doc.setFont('helvetica', 'bold');
                doc.text('Purchase Date:', 30, yPos);
                doc.setFont('helvetica', 'normal');
                doc.text(new Date(purchaseDate).toLocaleDateString('en-IN'), 80, yPos);

                yPos += 15;
                doc.setFont('helvetica', 'bold');
                doc.text('Warranty Period:', 30, yPos);
                doc.setFont('helvetica', 'normal');
                doc.text(warrantyPeriod + ' months', 80, yPos);

                // Calculate warranty expiry date
                const expiryDate = new Date(purchaseDate);
                expiryDate.setMonth(expiryDate.getMonth() + parseInt(warrantyPeriod));
                
                yPos += 15;
                doc.setFont('helvetica', 'bold');
                doc.text('Warranty Expires:', 30, yPos);
                doc.setFont('helvetica', 'normal');
                doc.text(expiryDate.toLocaleDateString('en-IN'), 80, yPos);

                // Verification Code Section
                const verificationCode = generateVerificationCode(billNumber, customerName);
                doc.setFillColor(...accentColor);
                doc.rect(20, 220, 170, 30, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text('VERIFICATION CODE:', 30, 235);
                doc.setFontSize(16);
                doc.text(verificationCode, 30, 245);

                // WhatsApp Button Info
                doc.setTextColor(...darkColor);
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.text('For warranty claims, contact us on WhatsApp: +91 8389846113', 105, 260, { align: 'center' });
                doc.text('Include this verification code in your message for faster processing', 105, 270, { align: 'center' });

                // Footer
                doc.setFontSize(8);
                doc.setTextColor(100, 100, 100);
                doc.text('This warranty card is valid only with original purchase receipt', 105, 285, { align: 'center' });
                doc.text('Made by Souptik/soup-codes.site', 105, 292, { align: 'center' });

                // Save the warranty data
                const warrantyData = {
                    customerName,
                    customerPhone,
                    customerAddress,
                    billNumber,
                    purchaseDate,
                    productName,
                    warrantyPeriod,
                    verificationCode,
                    issueDate: new Date().toISOString(),
                    expiryDate: expiryDate.toISOString()
                };
                
                // Save to localStorage for tracking
                const existingWarranties = JSON.parse(localStorage.getItem('warranties') || '[]');
                existingWarranties.push(warrantyData);
                localStorage.setItem('warranties', JSON.stringify(existingWarranties));

                // Save PDF
                const fileName = `SILITECH_Warranty_Card_${customerName.replace(/\s+/g, '_')}_${Date.now()}.pdf`;
                doc.save(fileName);
                
                document.getElementById('loading').style.display = 'none';
                
                // Show WhatsApp sharing option
                const whatsappMessage = `Hi! I've generated a warranty card for ${customerName}. Product: ${productName} | Bill No: ${billNumber} | Verification Code: ${verificationCode}`;
                const whatsappUrl = `https://wa.me/918389846113?text=${encodeURIComponent(whatsappMessage)}`;
                
                if (confirm('Warranty card generated successfully! Warranty data has been saved for future reference. Would you like to share this information via WhatsApp?')) {
                    window.open(whatsappUrl, '_blank');
                }
            }, 1500);
        }
    </script>
    
</body>
</html>